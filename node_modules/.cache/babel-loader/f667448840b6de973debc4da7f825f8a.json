{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst bignumber_js_1 = __importDefault(require(\"bignumber.js\"));\n\nconst utils = __importStar(require(\"./utils\"));\n\nconst validate = utils.common.validate;\nconst trustlineFlags = utils.common.txFlags.TrustSet;\n\nfunction convertQuality(quality) {\n  return new bignumber_js_1.default(quality).shiftedBy(9).integerValue(bignumber_js_1.default.ROUND_DOWN).toNumber();\n}\n\nfunction createTrustlineTransaction(account, trustline) {\n  const limit = {\n    currency: trustline.currency,\n    issuer: trustline.counterparty,\n    value: trustline.limit\n  };\n  const txJSON = {\n    TransactionType: 'TrustSet',\n    Account: account,\n    LimitAmount: limit,\n    Flags: 0\n  };\n\n  if (trustline.qualityIn != null) {\n    txJSON.QualityIn = convertQuality(trustline.qualityIn);\n  }\n\n  if (trustline.qualityOut != null) {\n    txJSON.QualityOut = convertQuality(trustline.qualityOut);\n  }\n\n  if (trustline.authorized === true) {\n    txJSON.Flags |= trustlineFlags.SetAuth;\n  }\n\n  if (trustline.ripplingDisabled != null) {\n    txJSON.Flags |= trustline.ripplingDisabled ? trustlineFlags.NoRipple : trustlineFlags.ClearNoRipple;\n  }\n\n  if (trustline.frozen != null) {\n    txJSON.Flags |= trustline.frozen ? trustlineFlags.SetFreeze : trustlineFlags.ClearFreeze;\n  }\n\n  if (trustline.memos != null) {\n    txJSON.Memos = trustline.memos.map(utils.convertMemo);\n  }\n\n  return txJSON;\n}\n\nfunction prepareTrustline(address, trustline) {\n  let instructions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  try {\n    validate.prepareTrustline({\n      address,\n      trustline,\n      instructions\n    });\n    const txJSON = createTrustlineTransaction(address, trustline);\n    return utils.prepareTransaction(txJSON, this, instructions);\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nexports.default = prepareTrustline;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA,MAAMA,QAAQ,GAAGC,KAAK,CAACC,MAAN,CAAaF,QAA9B;AACA,MAAMG,cAAc,GAAGF,KAAK,CAACC,MAAN,CAAaE,OAAb,CAAqBC,QAA5C;;AAKA,SAASC,cAAT,CAAwBC,OAAxB,EAA+B;AAC7B,SAAO,IAAIC,sBAAJ,CAAcD,OAAd,EACJE,SADI,CACM,CADN,EAEJC,YAFI,CAESF,uBAAUG,UAFnB,EAGJC,QAHI,EAAP;AAID;;AAED,SAASC,0BAAT,CACEC,OADF,EAEEC,SAFF,EAE4C;AAE1C,QAAMC,KAAK,GAAG;AACZC,YAAQ,EAAEF,SAAS,CAACE,QADR;AAEZC,UAAM,EAAEH,SAAS,CAACI,YAFN;AAGZC,SAAK,EAAEL,SAAS,CAACC;AAHL,GAAd;AAMA,QAAMK,MAAM,GAAQ;AAClBC,mBAAe,EAAE,UADC;AAElBC,WAAO,EAAET,OAFS;AAGlBU,eAAW,EAAER,KAHK;AAIlBS,SAAK,EAAE;AAJW,GAApB;;AAMA,MAAIV,SAAS,CAACW,SAAV,IAAuB,IAA3B,EAAiC;AAC/BL,UAAM,CAACM,SAAP,GAAmBrB,cAAc,CAACS,SAAS,CAACW,SAAX,CAAjC;AACD;;AACD,MAAIX,SAAS,CAACa,UAAV,IAAwB,IAA5B,EAAkC;AAChCP,UAAM,CAACQ,UAAP,GAAoBvB,cAAc,CAACS,SAAS,CAACa,UAAX,CAAlC;AACD;;AACD,MAAIb,SAAS,CAACe,UAAV,KAAyB,IAA7B,EAAmC;AACjCT,UAAM,CAACI,KAAP,IAAgBtB,cAAc,CAAC4B,OAA/B;AACD;;AACD,MAAIhB,SAAS,CAACiB,gBAAV,IAA8B,IAAlC,EAAwC;AACtCX,UAAM,CAACI,KAAP,IAAgBV,SAAS,CAACiB,gBAAV,GACZ7B,cAAc,CAAC8B,QADH,GAEZ9B,cAAc,CAAC+B,aAFnB;AAGD;;AACD,MAAInB,SAAS,CAACoB,MAAV,IAAoB,IAAxB,EAA8B;AAC5Bd,UAAM,CAACI,KAAP,IAAgBV,SAAS,CAACoB,MAAV,GACZhC,cAAc,CAACiC,SADH,GAEZjC,cAAc,CAACkC,WAFnB;AAGD;;AACD,MAAItB,SAAS,CAACuB,KAAV,IAAmB,IAAvB,EAA6B;AAC3BjB,UAAM,CAACkB,KAAP,GAAexB,SAAS,CAACuB,KAAV,CAAgBE,GAAhB,CAAoBvC,KAAK,CAACwC,WAA1B,CAAf;AACD;;AACD,SAAOpB,MAAP;AACD;;AAED,SAASqB,gBAAT,CAEEC,OAFF,EAGE5B,SAHF,EAIiC;AAAA,MAA/B6B,YAA+B,uEAAF,EAAE;;AAE/B,MAAI;AACF5C,YAAQ,CAAC0C,gBAAT,CAA0B;AAACC,aAAD;AAAU5B,eAAV;AAAqB6B;AAArB,KAA1B;AACA,UAAMvB,MAAM,GAAGR,0BAA0B,CAAC8B,OAAD,EAAU5B,SAAV,CAAzC;AACA,WAAOd,KAAK,CAAC4C,kBAAN,CAAyBxB,MAAzB,EAAiC,IAAjC,EAAuCuB,YAAvC,CAAP;AACD,GAJD,CAIE,OAAOE,CAAP,EAAU;AACV,WAAOC,OAAO,CAACC,MAAR,CAAeF,CAAf,CAAP;AACD;AACF;;AAEDG,kBAAeP,gBAAf","names":["validate","utils","common","trustlineFlags","txFlags","TrustSet","convertQuality","quality","bignumber_js_1","shiftedBy","integerValue","ROUND_DOWN","toNumber","createTrustlineTransaction","account","trustline","limit","currency","issuer","counterparty","value","txJSON","TransactionType","Account","LimitAmount","Flags","qualityIn","QualityIn","qualityOut","QualityOut","authorized","SetAuth","ripplingDisabled","NoRipple","ClearNoRipple","frozen","SetFreeze","ClearFreeze","memos","Memos","map","convertMemo","prepareTrustline","address","instructions","prepareTransaction","e","Promise","reject","exports"],"sourceRoot":"","sources":["../../../src/transaction/trustline.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}