{"ast":null,"code":"import { ValidationError } from './ValidationError';\nimport { ValidationTypes } from './ValidationTypes';\nimport { ValidationUtils } from './ValidationUtils';\nimport { isPromise, convertToArray } from '../utils';\nimport { getMetadataStorage } from '../metadata/MetadataStorage';\n/**\n * Executes validation over given object.\n */\n\nvar ValidationExecutor =\n/** @class */\nfunction () {\n  // -------------------------------------------------------------------------\n  // Constructor\n  // -------------------------------------------------------------------------\n  function ValidationExecutor(validator, validatorOptions) {\n    this.validator = validator;\n    this.validatorOptions = validatorOptions; // -------------------------------------------------------------------------\n    // Properties\n    // -------------------------------------------------------------------------\n\n    this.awaitingPromises = [];\n    this.ignoreAsyncValidations = false; // -------------------------------------------------------------------------\n    // Private Properties\n    // -------------------------------------------------------------------------\n\n    this.metadataStorage = getMetadataStorage();\n  } // -------------------------------------------------------------------------\n  // Public Methods\n  // -------------------------------------------------------------------------\n\n\n  ValidationExecutor.prototype.execute = function (object, targetSchema, validationErrors) {\n    var _this = this;\n    /**\n     * If there is no metadata registered it means possibly the dependencies are not flatterned and\n     * more than one instance is used.\n     *\n     * TODO: This needs proper handling, forcing to use the same container or some other proper solution.\n     */\n\n\n    if (!this.metadataStorage.hasValidationMetaData) {\n      console.warn(\"No metadata found. There is more than once class-validator version installed probably. You need to flatten your dependencies.\");\n    }\n\n    var groups = this.validatorOptions ? this.validatorOptions.groups : undefined;\n    var strictGroups = this.validatorOptions && this.validatorOptions.strictGroups || false;\n    var always = this.validatorOptions && this.validatorOptions.always || false;\n    var targetMetadatas = this.metadataStorage.getTargetValidationMetadatas(object.constructor, targetSchema, always, strictGroups, groups);\n    var groupedMetadatas = this.metadataStorage.groupByPropertyName(targetMetadatas);\n\n    if (this.validatorOptions && this.validatorOptions.forbidUnknownValues && !targetMetadatas.length) {\n      var validationError = new ValidationError();\n      if (!this.validatorOptions || !this.validatorOptions.validationError || this.validatorOptions.validationError.target === undefined || this.validatorOptions.validationError.target === true) validationError.target = object;\n      validationError.value = undefined;\n      validationError.property = undefined;\n      validationError.children = [];\n      validationError.constraints = {\n        unknownValue: 'an unknown value was passed to the validate function'\n      };\n      validationErrors.push(validationError);\n      return;\n    }\n\n    if (this.validatorOptions && this.validatorOptions.whitelist) this.whitelist(object, groupedMetadatas, validationErrors); // General validation\n\n    Object.keys(groupedMetadatas).forEach(function (propertyName) {\n      var value = object[propertyName];\n      var definedMetadatas = groupedMetadatas[propertyName].filter(function (metadata) {\n        return metadata.type === ValidationTypes.IS_DEFINED;\n      });\n      var metadatas = groupedMetadatas[propertyName].filter(function (metadata) {\n        return metadata.type !== ValidationTypes.IS_DEFINED && metadata.type !== ValidationTypes.WHITELIST;\n      });\n\n      if (value instanceof Promise && metadatas.find(function (metadata) {\n        return metadata.type === ValidationTypes.PROMISE_VALIDATION;\n      })) {\n        _this.awaitingPromises.push(value.then(function (resolvedValue) {\n          _this.performValidations(object, resolvedValue, propertyName, definedMetadatas, metadatas, validationErrors);\n        }));\n      } else {\n        _this.performValidations(object, value, propertyName, definedMetadatas, metadatas, validationErrors);\n      }\n    });\n  };\n\n  ValidationExecutor.prototype.whitelist = function (object, groupedMetadatas, validationErrors) {\n    var _this = this;\n\n    var notAllowedProperties = [];\n    Object.keys(object).forEach(function (propertyName) {\n      // does this property have no metadata?\n      if (!groupedMetadatas[propertyName] || groupedMetadatas[propertyName].length === 0) notAllowedProperties.push(propertyName);\n    });\n\n    if (notAllowedProperties.length > 0) {\n      if (this.validatorOptions && this.validatorOptions.forbidNonWhitelisted) {\n        // throw errors\n        notAllowedProperties.forEach(function (property) {\n          var _a;\n\n          var validationError = _this.generateValidationError(object, object[property], property);\n\n          validationError.constraints = (_a = {}, _a[ValidationTypes.WHITELIST] = \"property \" + property + \" should not exist\", _a);\n          validationError.children = undefined;\n          validationErrors.push(validationError);\n        });\n      } else {\n        // strip non allowed properties\n        notAllowedProperties.forEach(function (property) {\n          return delete object[property];\n        });\n      }\n    }\n  };\n\n  ValidationExecutor.prototype.stripEmptyErrors = function (errors) {\n    var _this = this;\n\n    return errors.filter(function (error) {\n      if (error.children) {\n        error.children = _this.stripEmptyErrors(error.children);\n      }\n\n      if (Object.keys(error.constraints).length === 0) {\n        if (error.children.length === 0) {\n          return false;\n        } else {\n          delete error.constraints;\n        }\n      }\n\n      return true;\n    });\n  }; // -------------------------------------------------------------------------\n  // Private Methods\n  // -------------------------------------------------------------------------\n\n\n  ValidationExecutor.prototype.performValidations = function (object, value, propertyName, definedMetadatas, metadatas, validationErrors) {\n    var customValidationMetadatas = metadatas.filter(function (metadata) {\n      return metadata.type === ValidationTypes.CUSTOM_VALIDATION;\n    });\n    var nestedValidationMetadatas = metadatas.filter(function (metadata) {\n      return metadata.type === ValidationTypes.NESTED_VALIDATION;\n    });\n    var conditionalValidationMetadatas = metadatas.filter(function (metadata) {\n      return metadata.type === ValidationTypes.CONDITIONAL_VALIDATION;\n    });\n    var validationError = this.generateValidationError(object, value, propertyName);\n    validationErrors.push(validationError);\n    var canValidate = this.conditionalValidations(object, value, conditionalValidationMetadatas);\n\n    if (!canValidate) {\n      return;\n    } // handle IS_DEFINED validation type the special way - it should work no matter skipUndefinedProperties/skipMissingProperties is set or not\n\n\n    this.customValidations(object, value, definedMetadatas, validationError);\n    this.mapContexts(object, value, definedMetadatas, validationError);\n\n    if (value === undefined && this.validatorOptions && this.validatorOptions.skipUndefinedProperties === true) {\n      return;\n    }\n\n    if (value === null && this.validatorOptions && this.validatorOptions.skipNullProperties === true) {\n      return;\n    }\n\n    if ((value === null || value === undefined) && this.validatorOptions && this.validatorOptions.skipMissingProperties === true) {\n      return;\n    }\n\n    this.customValidations(object, value, customValidationMetadatas, validationError);\n    this.nestedValidations(value, nestedValidationMetadatas, validationError.children);\n    this.mapContexts(object, value, metadatas, validationError);\n    this.mapContexts(object, value, customValidationMetadatas, validationError);\n  };\n\n  ValidationExecutor.prototype.generateValidationError = function (object, value, propertyName) {\n    var validationError = new ValidationError();\n    if (!this.validatorOptions || !this.validatorOptions.validationError || this.validatorOptions.validationError.target === undefined || this.validatorOptions.validationError.target === true) validationError.target = object;\n    if (!this.validatorOptions || !this.validatorOptions.validationError || this.validatorOptions.validationError.value === undefined || this.validatorOptions.validationError.value === true) validationError.value = value;\n    validationError.property = propertyName;\n    validationError.children = [];\n    validationError.constraints = {};\n    return validationError;\n  };\n\n  ValidationExecutor.prototype.conditionalValidations = function (object, value, metadatas) {\n    return metadatas.map(function (metadata) {\n      return metadata.constraints[0](object, value);\n    }).reduce(function (resultA, resultB) {\n      return resultA && resultB;\n    }, true);\n  };\n\n  ValidationExecutor.prototype.customValidations = function (object, value, metadatas, error) {\n    var _this = this;\n\n    metadatas.forEach(function (metadata) {\n      _this.metadataStorage.getTargetValidatorConstraints(metadata.constraintCls).forEach(function (customConstraintMetadata) {\n        if (customConstraintMetadata.async && _this.ignoreAsyncValidations) return;\n        if (_this.validatorOptions && _this.validatorOptions.stopAtFirstError && Object.keys(error.constraints || {}).length > 0) return;\n        var validationArguments = {\n          targetName: object.constructor ? object.constructor.name : undefined,\n          property: metadata.propertyName,\n          object: object,\n          value: value,\n          constraints: metadata.constraints\n        };\n\n        if (!metadata.each || !(value instanceof Array || value instanceof Set || value instanceof Map)) {\n          var validatedValue = customConstraintMetadata.instance.validate(value, validationArguments);\n\n          if (isPromise(validatedValue)) {\n            var promise = validatedValue.then(function (isValid) {\n              if (!isValid) {\n                var _a = _this.createValidationError(object, value, metadata, customConstraintMetadata),\n                    type = _a[0],\n                    message = _a[1];\n\n                error.constraints[type] = message;\n\n                if (metadata.context) {\n                  if (!error.contexts) {\n                    error.contexts = {};\n                  }\n\n                  error.contexts[type] = Object.assign(error.contexts[type] || {}, metadata.context);\n                }\n              }\n            });\n\n            _this.awaitingPromises.push(promise);\n          } else {\n            if (!validatedValue) {\n              var _a = _this.createValidationError(object, value, metadata, customConstraintMetadata),\n                  type = _a[0],\n                  message = _a[1];\n\n              error.constraints[type] = message;\n            }\n          }\n\n          return;\n        } // convert set and map into array\n\n\n        var arrayValue = convertToArray(value); // Validation needs to be applied to each array item\n\n        var validatedSubValues = arrayValue.map(function (subValue) {\n          return customConstraintMetadata.instance.validate(subValue, validationArguments);\n        });\n        var validationIsAsync = validatedSubValues.some(function (validatedSubValue) {\n          return isPromise(validatedSubValue);\n        });\n\n        if (validationIsAsync) {\n          // Wrap plain values (if any) in promises, so that all are async\n          var asyncValidatedSubValues = validatedSubValues.map(function (validatedSubValue) {\n            return isPromise(validatedSubValue) ? validatedSubValue : Promise.resolve(validatedSubValue);\n          });\n          var asyncValidationIsFinishedPromise = Promise.all(asyncValidatedSubValues).then(function (flatValidatedValues) {\n            var validationResult = flatValidatedValues.every(function (isValid) {\n              return isValid;\n            });\n\n            if (!validationResult) {\n              var _a = _this.createValidationError(object, value, metadata, customConstraintMetadata),\n                  type = _a[0],\n                  message = _a[1];\n\n              error.constraints[type] = message;\n\n              if (metadata.context) {\n                if (!error.contexts) {\n                  error.contexts = {};\n                }\n\n                error.contexts[type] = Object.assign(error.contexts[type] || {}, metadata.context);\n              }\n            }\n          });\n\n          _this.awaitingPromises.push(asyncValidationIsFinishedPromise);\n\n          return;\n        }\n\n        var validationResult = validatedSubValues.every(function (isValid) {\n          return isValid;\n        });\n\n        if (!validationResult) {\n          var _b = _this.createValidationError(object, value, metadata, customConstraintMetadata),\n              type = _b[0],\n              message = _b[1];\n\n          error.constraints[type] = message;\n        }\n      });\n    });\n  };\n\n  ValidationExecutor.prototype.nestedValidations = function (value, metadatas, errors) {\n    var _this = this;\n\n    if (value === void 0) {\n      return;\n    }\n\n    metadatas.forEach(function (metadata) {\n      var _a;\n\n      if (metadata.type !== ValidationTypes.NESTED_VALIDATION && metadata.type !== ValidationTypes.PROMISE_VALIDATION) {\n        return;\n      }\n\n      if (value instanceof Array || value instanceof Set || value instanceof Map) {\n        // Treats Set as an array - as index of Set value is value itself and it is common case to have Object as value\n        var arrayLikeValue = value instanceof Set ? Array.from(value) : value;\n        arrayLikeValue.forEach(function (subValue, index) {\n          _this.performValidations(value, subValue, index.toString(), [], metadatas, errors);\n        });\n      } else if (value instanceof Object) {\n        var targetSchema = typeof metadata.target === 'string' ? metadata.target : metadata.target.name;\n\n        _this.execute(value, targetSchema, errors);\n      } else {\n        var error = new ValidationError();\n        error.value = value;\n        error.property = metadata.propertyName;\n        error.target = metadata.target;\n\n        var _b = _this.createValidationError(metadata.target, value, metadata),\n            type = _b[0],\n            message = _b[1];\n\n        error.constraints = (_a = {}, _a[type] = message, _a);\n        errors.push(error);\n      }\n    });\n  };\n\n  ValidationExecutor.prototype.mapContexts = function (object, value, metadatas, error) {\n    var _this = this;\n\n    return metadatas.forEach(function (metadata) {\n      if (metadata.context) {\n        var customConstraint = void 0;\n\n        if (metadata.type === ValidationTypes.CUSTOM_VALIDATION) {\n          var customConstraints = _this.metadataStorage.getTargetValidatorConstraints(metadata.constraintCls);\n\n          customConstraint = customConstraints[0];\n        }\n\n        var type = _this.getConstraintType(metadata, customConstraint);\n\n        if (error.constraints[type]) {\n          if (!error.contexts) {\n            error.contexts = {};\n          }\n\n          error.contexts[type] = Object.assign(error.contexts[type] || {}, metadata.context);\n        }\n      }\n    });\n  };\n\n  ValidationExecutor.prototype.createValidationError = function (object, value, metadata, customValidatorMetadata) {\n    var targetName = object.constructor ? object.constructor.name : undefined;\n    var type = this.getConstraintType(metadata, customValidatorMetadata);\n    var validationArguments = {\n      targetName: targetName,\n      property: metadata.propertyName,\n      object: object,\n      value: value,\n      constraints: metadata.constraints\n    };\n    var message = metadata.message || '';\n\n    if (!metadata.message && (!this.validatorOptions || this.validatorOptions && !this.validatorOptions.dismissDefaultMessages)) {\n      if (customValidatorMetadata && customValidatorMetadata.instance.defaultMessage instanceof Function) {\n        message = customValidatorMetadata.instance.defaultMessage(validationArguments);\n      }\n    }\n\n    var messageString = ValidationUtils.replaceMessageSpecialTokens(message, validationArguments);\n    return [type, messageString];\n  };\n\n  ValidationExecutor.prototype.getConstraintType = function (metadata, customValidatorMetadata) {\n    var type = customValidatorMetadata && customValidatorMetadata.name ? customValidatorMetadata.name : metadata.type;\n    return type;\n  };\n\n  return ValidationExecutor;\n}();\n\nexport { ValidationExecutor };","map":{"version":3,"mappings":"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","names":["ValidationError","ValidationTypes","ValidationUtils","isPromise","convertToArray","getMetadataStorage","validator","validatorOptions","ValidationExecutor","object","targetSchema","validationErrors","metadataStorage","hasValidationMetaData","console","warn","groups","undefined","strictGroups","always","targetMetadatas","getTargetValidationMetadatas","constructor","groupedMetadatas","groupByPropertyName","forbidUnknownValues","length","validationError","target","value","property","children","constraints","unknownValue","push","whitelist","Object","keys","forEach","propertyName","definedMetadatas","filter","type","IS_DEFINED","metadatas","metadata","WHITELIST","Promise","find","PROMISE_VALIDATION","_this","awaitingPromises","then","performValidations","resolvedValue","notAllowedProperties","forbidNonWhitelisted","generateValidationError","_a","errors","error","stripEmptyErrors","customValidationMetadatas","CUSTOM_VALIDATION","nestedValidationMetadatas","NESTED_VALIDATION","conditionalValidationMetadatas","CONDITIONAL_VALIDATION","canValidate","conditionalValidations","customValidations","mapContexts","skipUndefinedProperties","skipNullProperties","skipMissingProperties","nestedValidations","map","reduce","resultA","resultB","getTargetValidatorConstraints","constraintCls","customConstraintMetadata","async","ignoreAsyncValidations","stopAtFirstError","validationArguments","targetName","name","each","Array","Set","Map","validatedValue","instance","validate","promise","isValid","createValidationError","message","context","contexts","assign","arrayValue","validatedSubValues","subValue","validationIsAsync","some","validatedSubValue","asyncValidatedSubValues","resolve","asyncValidationIsFinishedPromise","all","flatValidatedValues","validationResult","every","arrayLikeValue","from","index","toString","execute","customConstraint","customConstraints","getConstraintType","customValidatorMetadata","dismissDefaultMessages","defaultMessage","Function","messageString","replaceMessageSpecialTokens"],"sourceRoot":"","sources":["../../../src/validation/ValidationExecutor.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}