{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AsyncTimer = void 0;\n\nconst errors = __importStar(require(\"./errors\"));\n\nconst errors_1 = require(\"./errors\");\n\nconst logger_1 = require(\"./logger\");\n/*\n * AsyncTimer is an async-friendly abstraction that wraps JavaScript's setTimeout() and clearTimeout().\n */\n\n\nclass AsyncTimer {\n  /**\n   * Creates an AsyncTimer.\n   */\n  constructor(name) {\n    this.timeoutHandle = null;\n    this.rejectionFunc = null;\n    this.name = name;\n    this.correlationTag = 0;\n  }\n  /**\n   * Starts the timer.\n   * @param timeout The time (in milliseconds) to wait until resolving the promise.\n   */\n\n\n  start(timeout) {\n    if (this.timeoutHandle) {\n      throw new errors.ErrAsyncTimerAlreadyRunning();\n    }\n\n    this.correlationTag++;\n    logger_1.Logger.trace(`AsyncTimer[${this.name}'${this.correlationTag}].start()`);\n    return new Promise((resolve, reject) => {\n      this.rejectionFunc = reject;\n\n      let timeoutCallback = () => {\n        this.rejectionFunc = null;\n        this.stop();\n        resolve();\n      };\n\n      this.timeoutHandle = setTimeout(timeoutCallback, timeout);\n    });\n  }\n  /**\n   * Aborts the timer: rejects the promise (if any) and stops the timer.\n   */\n\n\n  abort() {\n    logger_1.Logger.trace(`AsyncTimer[${this.name}'${this.correlationTag}].abort()`);\n\n    if (this.rejectionFunc) {\n      this.rejectionFunc(new errors_1.ErrAsyncTimerAborted());\n      this.rejectionFunc = null;\n    }\n\n    this.stop();\n  }\n  /**\n   * Stops the timer.\n   */\n\n\n  stop() {\n    if (this.isStopped()) {\n      return;\n    }\n\n    logger_1.Logger.trace(`AsyncTimer[${this.name}'${this.correlationTag}].stop()`);\n\n    if (this.timeoutHandle) {\n      clearTimeout(this.timeoutHandle);\n      this.timeoutHandle = null;\n    }\n  }\n  /**\n   * Returns whether the timer is stopped.\n   */\n\n\n  isStopped() {\n    return this.timeoutHandle ? false : true;\n  }\n\n}\n\nexports.AsyncTimer = AsyncTimer;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;AAEA;;;;;AAGA,MAAaA,UAAb,CAAuB;AAMnB;;;AAGAC,cAAYC,IAAZ,EAAwB;AAPhB,yBAAqB,IAArB;AACA,yBAAqB,IAArB;AAOJ,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKC,cAAL,GAAsB,CAAtB;AACH;AAED;;;;;;AAIOC,OAAK,CAACC,OAAD,EAAgB;AACxB,QAAI,KAAKC,aAAT,EAAwB;AACpB,YAAM,IAAIC,MAAM,CAACC,2BAAX,EAAN;AACH;;AAED,SAAKL,cAAL;AACAM,oBAAOC,KAAP,CAAa,cAAc,KAAKR,IAAI,IAAI,KAAKC,cAAc,WAA3D;AAEA,WAAO,IAAIQ,OAAJ,CAAkB,CAACC,OAAD,EAAUC,MAAV,KAAoB;AACzC,WAAKC,aAAL,GAAqBD,MAArB;;AAEA,UAAIE,eAAe,GAAG,MAAK;AACvB,aAAKD,aAAL,GAAqB,IAArB;AACA,aAAKE,IAAL;AACAJ,eAAO;AACV,OAJD;;AAMA,WAAKN,aAAL,GAAqBW,UAAU,CAACF,eAAD,EAAkBV,OAAlB,CAA/B;AACH,KAVM,CAAP;AAWH;AAED;;;;;AAGOa,OAAK;AACRT,oBAAOC,KAAP,CAAa,cAAc,KAAKR,IAAI,IAAI,KAAKC,cAAc,WAA3D;;AAEA,QAAI,KAAKW,aAAT,EAAwB;AACpB,WAAKA,aAAL,CAAmB,IAAIK,6BAAJ,EAAnB;AACA,WAAKL,aAAL,GAAqB,IAArB;AACH;;AAED,SAAKE,IAAL;AACH;AAED;;;;;AAGOA,MAAI;AACP,QAAI,KAAKI,SAAL,EAAJ,EAAsB;AAClB;AACH;;AAEDX,oBAAOC,KAAP,CAAa,cAAc,KAAKR,IAAI,IAAI,KAAKC,cAAc,UAA3D;;AAEA,QAAI,KAAKG,aAAT,EAAwB;AACpBe,kBAAY,CAAC,KAAKf,aAAN,CAAZ;AACA,WAAKA,aAAL,GAAqB,IAArB;AACH;AACJ;AAED;;;;;AAGOc,WAAS;AACZ,WAAO,KAAKd,aAAL,GAAqB,KAArB,GAA6B,IAApC;AACH;;AA1EkB;;AAAvBgB","names":["AsyncTimer","constructor","name","correlationTag","start","timeout","timeoutHandle","errors","ErrAsyncTimerAlreadyRunning","logger_1","trace","Promise","resolve","reject","rejectionFunc","timeoutCallback","stop","setTimeout","abort","errors_1","isStopped","clearTimeout","exports"],"sourceRoot":"","sources":["../src/asyncTimer.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}