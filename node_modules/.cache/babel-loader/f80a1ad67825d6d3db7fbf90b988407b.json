{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TypedResult = exports.SmartContractResultItem = exports.SmartContractResults = void 0;\n\nconst address_1 = require(\"../address\");\n\nconst balance_1 = require(\"../balance\");\n\nconst hash_1 = require(\"../hash\");\n\nconst networkParams_1 = require(\"../networkParams\");\n\nconst nonce_1 = require(\"../nonce\");\n\nconst transaction_1 = require(\"../transaction\");\n\nconst argSerializer_1 = require(\"./argSerializer\");\n\nconst returnCode_1 = require(\"./returnCode\");\n\nconst result_1 = require(\"./result\");\n\nclass SmartContractResults {\n  constructor(items) {\n    this.items = [];\n    this.immediate = new TypedResult();\n    this.resultingCalls = [];\n    this.items = items;\n\n    if (this.items.length > 0) {\n      let immediateResult = this.findImmediateResult();\n\n      if (immediateResult) {\n        this.immediate = immediateResult;\n      }\n\n      this.resultingCalls = this.findResultingCalls();\n    }\n  }\n\n  static empty() {\n    return new SmartContractResults([]);\n  }\n\n  static fromHttpResponse(smartContractResults) {\n    let items = (smartContractResults || []).map(item => SmartContractResultItem.fromHttpResponse(item));\n    return new SmartContractResults(items);\n  }\n\n  findImmediateResult() {\n    let immediateItem = this.items.filter(item => isImmediateResult(item))[0];\n\n    if (immediateItem) {\n      return new TypedResult(immediateItem);\n    }\n\n    return undefined;\n  }\n\n  findResultingCalls() {\n    let otherItems = this.items.filter(item => !isImmediateResult(item));\n    let resultingCalls = otherItems.map(item => new TypedResult(item));\n    return resultingCalls;\n  }\n\n  getImmediate() {\n    return this.immediate;\n  }\n\n  getResultingCalls() {\n    return this.resultingCalls;\n  }\n\n  getAllResults() {\n    return this.items.map(item => new TypedResult(item));\n  }\n\n}\n\nexports.SmartContractResults = SmartContractResults;\n\nfunction isImmediateResult(item) {\n  return item.nonce.valueOf() != 0;\n}\n\nclass SmartContractResultItem {\n  constructor() {\n    this.hash = hash_1.Hash.empty();\n    this.nonce = new nonce_1.Nonce(0);\n    this.value = balance_1.Balance.Zero();\n    this.receiver = new address_1.Address();\n    this.sender = new address_1.Address();\n    this.data = \"\";\n    this.previousHash = hash_1.Hash.empty();\n    this.originalHash = hash_1.Hash.empty();\n    this.gasLimit = new networkParams_1.GasLimit(0);\n    this.gasPrice = new networkParams_1.GasPrice(0);\n    this.callType = 0;\n    this.returnMessage = \"\";\n  }\n\n  static fromHttpResponse(response) {\n    let item = new SmartContractResultItem();\n    item.hash = new transaction_1.TransactionHash(response.hash);\n    item.nonce = new nonce_1.Nonce(response.nonce || 0);\n    item.value = balance_1.Balance.fromString(response.value);\n    item.receiver = new address_1.Address(response.receiver);\n    item.sender = new address_1.Address(response.sender);\n    item.data = response.data || \"\";\n    item.previousHash = new transaction_1.TransactionHash(response.prevTxHash);\n    item.originalHash = new transaction_1.TransactionHash(response.originalTxHash);\n    item.gasLimit = new networkParams_1.GasLimit(response.gasLimit);\n    item.gasPrice = new networkParams_1.GasPrice(response.gasPrice);\n    item.callType = response.callType;\n    item.returnMessage = response.returnMessage;\n    return item;\n  }\n\n  getDataTokens() {\n    return new argSerializer_1.ArgSerializer().stringToBuffers(this.data);\n  }\n\n}\n\nexports.SmartContractResultItem = SmartContractResultItem;\n\nclass TypedResult extends SmartContractResultItem {\n  constructor(init) {\n    super();\n    Object.assign(this, init);\n  }\n\n  assertSuccess() {\n    result_1.Result.assertSuccess(this);\n  }\n\n  isSuccess() {\n    return this.getReturnCode().isSuccess();\n  }\n\n  getReturnCode() {\n    let tokens = this.getDataTokens();\n\n    if (tokens.length < 2) {\n      return returnCode_1.ReturnCode.None;\n    }\n\n    let returnCodeToken = tokens[1];\n    return returnCode_1.ReturnCode.fromBuffer(returnCodeToken);\n  }\n\n  outputUntyped() {\n    this.assertSuccess(); // Skip the first 2 SCRs (eg. the @6f6b from @6f6b@2b).\n\n    return this.getDataTokens().slice(2);\n  }\n\n  setEndpointDefinition(endpointDefinition) {\n    this.endpointDefinition = endpointDefinition;\n  }\n\n  getEndpointDefinition() {\n    return this.endpointDefinition;\n  }\n\n  getReturnMessage() {\n    return this.returnMessage;\n  }\n\n  outputTyped() {\n    return result_1.Result.outputTyped(this);\n  }\n\n  unpackOutput() {\n    return result_1.Result.unpackOutput(this);\n  }\n\n}\n\nexports.TypedResult = TypedResult;","map":{"version":3,"mappings":"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","names":["SmartContractResults","constructor","items","TypedResult","length","immediateResult","findImmediateResult","immediate","resultingCalls","findResultingCalls","empty","fromHttpResponse","smartContractResults","map","item","SmartContractResultItem","immediateItem","filter","isImmediateResult","undefined","otherItems","getImmediate","getResultingCalls","getAllResults","exports","nonce","valueOf","hash_1","nonce_1","balance_1","Zero","address_1","networkParams_1","response","hash","transaction_1","value","fromString","receiver","sender","data","previousHash","prevTxHash","originalHash","originalTxHash","gasLimit","gasPrice","callType","returnMessage","getDataTokens","argSerializer_1","stringToBuffers","init","Object","assign","assertSuccess","result_1","isSuccess","getReturnCode","tokens","returnCode_1","None","returnCodeToken","fromBuffer","outputUntyped","slice","setEndpointDefinition","endpointDefinition","getEndpointDefinition","getReturnMessage","outputTyped","unpackOutput"],"sourceRoot":"","sources":["../../src/smartcontracts/smartContractResults.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}