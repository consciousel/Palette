{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DefaultInteractionRunner = void 0;\n/**\n * An interaction runner suitable for backends or wallets.\n * Not suitable for dapps, which depend on external signers (wallets, ledger etc.).\n */\n\nclass DefaultInteractionRunner {\n  constructor(checker, signer, provider) {\n    this.checker = checker;\n    this.signer = signer;\n    this.provider = provider;\n  }\n  /**\n   * Given an interaction, broadcasts its compiled transaction.\n   */\n\n\n  run(interaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.checkInteraction(interaction);\n      let transaction = interaction.buildTransaction();\n      yield this.signer.sign(transaction);\n      yield transaction.send(this.provider);\n      return transaction;\n    });\n  }\n  /**\n   * Given an interaction, broadcasts its compiled transaction (and also waits for its execution on the Network).\n   */\n\n\n  runAwaitExecution(interaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.checkInteraction(interaction);\n      let transaction = yield this.run(interaction);\n      yield transaction.awaitExecuted(this.provider); // This will wait until the transaction is notarized, as well (so that SCRs are returned by the API).\n\n      let transactionOnNetwork = yield transaction.getAsOnNetwork(this.provider);\n      let bundle = interaction.interpretExecutionResults(transactionOnNetwork);\n      return bundle;\n    });\n  }\n\n  runQuery(interaction, caller) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.checkInteraction(interaction);\n      let query = interaction.buildQuery();\n      query.caller = caller || this.signer.getAddress();\n      let response = yield this.provider.queryContract(query);\n      let bundle = interaction.interpretQueryResponse(response);\n      return bundle;\n    });\n  }\n\n  runSimulation(interaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.checkInteraction(interaction);\n      let transaction = interaction.buildTransaction();\n      yield this.signer.sign(transaction);\n      return yield transaction.simulate(this.provider);\n    });\n  }\n\n  checkInteraction(interaction) {\n    this.checker.checkInteraction(interaction);\n  }\n\n}\n\nexports.DefaultInteractionRunner = DefaultInteractionRunner;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA;;;;;AAIA,MAAaA,wBAAb,CAAqC;AAKjCC,cAAYC,OAAZ,EAA0CC,MAA1C,EAA2DC,QAA3D,EAA8E;AAC1E,SAAKF,OAAL,GAAeA,OAAf;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACH;AAED;;;;;AAGMC,KAAG,CAACC,WAAD,EAAyB;;AAC9B,WAAKC,gBAAL,CAAsBD,WAAtB;AAEA,UAAIE,WAAW,GAAGF,WAAW,CAACG,gBAAZ,EAAlB;AACA,YAAM,KAAKN,MAAL,CAAYO,IAAZ,CAAiBF,WAAjB,CAAN;AACA,YAAMA,WAAW,CAACG,IAAZ,CAAiB,KAAKP,QAAtB,CAAN;AACA,aAAOI,WAAP;AACH;AAAA;AAED;;;;;AAGMI,mBAAiB,CAACN,WAAD,EAAyB;;AAC5C,WAAKC,gBAAL,CAAsBD,WAAtB;AAEA,UAAIE,WAAW,GAAG,MAAM,KAAKH,GAAL,CAASC,WAAT,CAAxB;AACA,YAAME,WAAW,CAACK,aAAZ,CAA0B,KAAKT,QAA/B,CAAN,EACA;;AACA,UAAIU,oBAAoB,GAAG,MAAMN,WAAW,CAACO,cAAZ,CAA2B,KAAKX,QAAhC,CAAjC;AACA,UAAIY,MAAM,GAAGV,WAAW,CAACW,yBAAZ,CAAsCH,oBAAtC,CAAb;AACA,aAAOE,MAAP;AACH;AAAA;;AAEKE,UAAQ,CAACZ,WAAD,EAA2Ba,MAA3B,EAA2C;;AACrD,WAAKZ,gBAAL,CAAsBD,WAAtB;AAEA,UAAIc,KAAK,GAAGd,WAAW,CAACe,UAAZ,EAAZ;AACAD,WAAK,CAACD,MAAN,GAAeA,MAAM,IAAI,KAAKhB,MAAL,CAAYmB,UAAZ,EAAzB;AACA,UAAIC,QAAQ,GAAG,MAAM,KAAKnB,QAAL,CAAcoB,aAAd,CAA4BJ,KAA5B,CAArB;AACA,UAAIJ,MAAM,GAAGV,WAAW,CAACmB,sBAAZ,CAAmCF,QAAnC,CAAb;AACA,aAAOP,MAAP;AACH;AAAA;;AAEKU,eAAa,CAACpB,WAAD,EAAyB;;AACxC,WAAKC,gBAAL,CAAsBD,WAAtB;AAEA,UAAIE,WAAW,GAAGF,WAAW,CAACG,gBAAZ,EAAlB;AACA,YAAM,KAAKN,MAAL,CAAYO,IAAZ,CAAiBF,WAAjB,CAAN;AACA,aAAO,MAAMA,WAAW,CAACmB,QAAZ,CAAqB,KAAKvB,QAA1B,CAAb;AACH;AAAA;;AAEOG,kBAAgB,CAACD,WAAD,EAAyB;AAC7C,SAAKJ,OAAL,CAAaK,gBAAb,CAA8BD,WAA9B;AACH;;AAzDgC;;AAArCsB","names":["DefaultInteractionRunner","constructor","checker","signer","provider","run","interaction","checkInteraction","transaction","buildTransaction","sign","send","runAwaitExecution","awaitExecuted","transactionOnNetwork","getAsOnNetwork","bundle","interpretExecutionResults","runQuery","caller","query","buildQuery","getAddress","response","queryContract","interpretQueryResponse","runSimulation","simulate","exports"],"sourceRoot":"","sources":["../../src/smartcontracts/defaultRunner.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}