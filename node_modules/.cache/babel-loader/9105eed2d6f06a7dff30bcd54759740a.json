{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst _ = __importStar(require(\"lodash\"));\n\nconst amount_1 = __importDefault(require(\"./amount\"));\n\nfunction parsePaths(paths) {\n  return paths.map(steps => steps.map(step => _.omit(step, ['type', 'type_hex'])));\n}\n\nfunction removeAnyCounterpartyEncoding(address, amount) {\n  return amount.counterparty === address ? _.omit(amount, 'counterparty') : amount;\n}\n\nfunction createAdjustment(address, adjustmentWithoutAddress) {\n  const amountKey = Object.keys(adjustmentWithoutAddress)[0];\n  const amount = adjustmentWithoutAddress[amountKey];\n  return _.set({\n    address: address\n  }, amountKey, removeAnyCounterpartyEncoding(address, amount));\n}\n\nfunction parseAlternative(sourceAddress, destinationAddress, destinationAmount, alternative) {\n  const amounts = alternative.destination_amount != null ? {\n    source: {\n      amount: amount_1.default(alternative.source_amount)\n    },\n    destination: {\n      minAmount: amount_1.default(alternative.destination_amount)\n    }\n  } : {\n    source: {\n      maxAmount: amount_1.default(alternative.source_amount)\n    },\n    destination: {\n      amount: amount_1.default(destinationAmount)\n    }\n  };\n  return {\n    source: createAdjustment(sourceAddress, amounts.source),\n    destination: createAdjustment(destinationAddress, amounts.destination),\n    paths: JSON.stringify(parsePaths(alternative.paths_computed))\n  };\n}\n\nfunction parsePathfind(pathfindResult) {\n  const sourceAddress = pathfindResult.source_account;\n  const destinationAddress = pathfindResult.destination_account;\n  const destinationAmount = pathfindResult.destination_amount;\n  return pathfindResult.alternatives.map(alt => parseAlternative(sourceAddress, destinationAddress, destinationAmount, alt));\n}\n\nexports.default = parsePathfind;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAIA,SAASA,UAAT,CAAoBC,KAApB,EAAyB;AACvB,SAAOA,KAAK,CAACC,GAAN,CAAWC,KAAD,IACfA,KAAK,CAACD,GAAN,CAAWE,IAAD,IAAUC,CAAC,CAACC,IAAF,CAAOF,IAAP,EAAa,CAAC,MAAD,EAAS,UAAT,CAAb,CAApB,CADK,CAAP;AAGD;;AAED,SAASG,6BAAT,CAAuCC,OAAvC,EAAwDC,MAAxD,EAAsE;AACpE,SAAOA,MAAM,CAACC,YAAP,KAAwBF,OAAxB,GACHH,CAAC,CAACC,IAAF,CAAOG,MAAP,EAAe,cAAf,CADG,GAEHA,MAFJ;AAGD;;AAED,SAASE,gBAAT,CACEH,OADF,EAEEI,wBAFF,EAEkC;AAEhC,QAAMC,SAAS,GAAGC,MAAM,CAACC,IAAP,CAAYH,wBAAZ,EAAsC,CAAtC,CAAlB;AACA,QAAMH,MAAM,GAAGG,wBAAwB,CAACC,SAAD,CAAvC;AACA,SAAOR,CAAC,CAACW,GAAF,CACL;AAACR,WAAO,EAAEA;AAAV,GADK,EAELK,SAFK,EAGLN,6BAA6B,CAACC,OAAD,EAAUC,MAAV,CAHxB,CAAP;AAKD;;AAED,SAASQ,gBAAT,CACEC,aADF,EAEEC,kBAFF,EAGEC,iBAHF,EAIEC,WAJF,EAIkB;AAIhB,QAAMC,OAAO,GACXD,WAAW,CAACE,kBAAZ,IAAkC,IAAlC,GACI;AACEC,UAAM,EAAE;AAACf,YAAM,EAAEgB,iBAAYJ,WAAW,CAACK,aAAxB;AAAT,KADV;AAEEC,eAAW,EAAE;AAACC,eAAS,EAAEH,iBAAYJ,WAAW,CAACE,kBAAxB;AAAZ;AAFf,GADJ,GAKI;AACEC,UAAM,EAAE;AAACK,eAAS,EAAEJ,iBAAYJ,WAAW,CAACK,aAAxB;AAAZ,KADV;AAEEC,eAAW,EAAE;AAAClB,YAAM,EAAEgB,iBAAYL,iBAAZ;AAAT;AAFf,GANN;AAWA,SAAO;AACLI,UAAM,EAAEb,gBAAgB,CAACO,aAAD,EAAgBI,OAAO,CAACE,MAAxB,CADnB;AAELG,eAAW,EAAEhB,gBAAgB,CAACQ,kBAAD,EAAqBG,OAAO,CAACK,WAA7B,CAFxB;AAGL1B,SAAK,EAAE6B,IAAI,CAACC,SAAL,CAAe/B,UAAU,CAACqB,WAAW,CAACW,cAAb,CAAzB;AAHF,GAAP;AAKD;;AAED,SAASC,aAAT,CAAuBC,cAAvB,EAA2D;AACzD,QAAMhB,aAAa,GAAGgB,cAAc,CAACC,cAArC;AACA,QAAMhB,kBAAkB,GAAGe,cAAc,CAACE,mBAA1C;AACA,QAAMhB,iBAAiB,GAAGc,cAAc,CAACX,kBAAzC;AACA,SAAOW,cAAc,CAACG,YAAf,CAA4BnC,GAA5B,CAAiCoC,GAAD,IACrCrB,gBAAgB,CAACC,aAAD,EAAgBC,kBAAhB,EAAoCC,iBAApC,EAAuDkB,GAAvD,CADX,CAAP;AAGD;;AAEDC,kBAAeN,aAAf","names":["parsePaths","paths","map","steps","step","_","omit","removeAnyCounterpartyEncoding","address","amount","counterparty","createAdjustment","adjustmentWithoutAddress","amountKey","Object","keys","set","parseAlternative","sourceAddress","destinationAddress","destinationAmount","alternative","amounts","destination_amount","source","amount_1","source_amount","destination","minAmount","maxAmount","JSON","stringify","paths_computed","parsePathfind","pathfindResult","source_account","destination_account","alternatives","alt","exports"],"sourceRoot":"","sources":["../../../../src/ledger/parse/pathfind.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}