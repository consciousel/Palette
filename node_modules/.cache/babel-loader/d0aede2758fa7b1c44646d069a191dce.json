{"ast":null,"code":"\"use strict\";\n/**\n * Codec class\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isValidClassicAddress = exports.decodeAccountPublic = exports.encodeAccountPublic = exports.encodeNodePublic = exports.decodeNodePublic = exports.decodeAddress = exports.decodeAccountID = exports.encodeAddress = exports.encodeAccountID = exports.decodeSeed = exports.encodeSeed = exports.codec = void 0;\n\nconst baseCodec = require(\"base-x\");\n\nconst createHash = require(\"create-hash\");\n\nconst utils_1 = require(\"./utils\");\n\nclass Codec {\n  constructor(options) {\n    this._sha256 = options.sha256;\n    this._alphabet = options.alphabet;\n    this._codec = baseCodec(this._alphabet);\n  }\n  /**\n   * Encoder.\n   *\n   * @param bytes - Buffer of data to encode.\n   * @param opts - Options object including the version bytes and the expected length of the data to encode.\n   */\n\n\n  encode(bytes, opts) {\n    const versions = opts.versions;\n    return this._encodeVersioned(bytes, versions, opts.expectedLength);\n  }\n  /**\n   * Decoder.\n   *\n   * @param base58string - Base58Check-encoded string to decode.\n   * @param opts - Options object including the version byte(s) and the expected length of the data after decoding.\n   */\n\n  /* eslint-disable max-lines-per-function --\n   * TODO refactor */\n\n\n  decode(base58string, opts) {\n    var _a;\n\n    const versions = opts.versions;\n    const types = opts.versionTypes;\n    const withoutSum = this.decodeChecked(base58string);\n\n    if (versions.length > 1 && !opts.expectedLength) {\n      throw new Error('expectedLength is required because there are >= 2 possible versions');\n    }\n\n    const versionLengthGuess = typeof versions[0] === 'number' ? 1 : versions[0].length;\n    const payloadLength = (_a = opts.expectedLength) !== null && _a !== void 0 ? _a : withoutSum.length - versionLengthGuess;\n    const versionBytes = withoutSum.slice(0, -payloadLength);\n    const payload = withoutSum.slice(-payloadLength);\n\n    for (let i = 0; i < versions.length; i++) {\n      /* eslint-disable @typescript-eslint/consistent-type-assertions --\n       * TODO refactor */\n      const version = Array.isArray(versions[i]) ? versions[i] : [versions[i]];\n\n      if ((0, utils_1.seqEqual)(versionBytes, version)) {\n        return {\n          version,\n          bytes: payload,\n          type: types ? types[i] : null\n        };\n      }\n      /* eslint-enable @typescript-eslint/consistent-type-assertions */\n\n    }\n\n    throw new Error('version_invalid: version bytes do not match any of the provided version(s)');\n  }\n\n  encodeChecked(buffer) {\n    const check = this._sha256(this._sha256(buffer)).slice(0, 4);\n\n    return this._encodeRaw(Buffer.from((0, utils_1.concatArgs)(buffer, check)));\n  }\n\n  decodeChecked(base58string) {\n    const buffer = this._decodeRaw(base58string);\n\n    if (buffer.length < 5) {\n      throw new Error('invalid_input_size: decoded data must have length >= 5');\n    }\n\n    if (!this._verifyCheckSum(buffer)) {\n      throw new Error('checksum_invalid');\n    }\n\n    return buffer.slice(0, -4);\n  }\n\n  _encodeVersioned(bytes, versions, expectedLength) {\n    if (expectedLength && bytes.length !== expectedLength) {\n      throw new Error('unexpected_payload_length: bytes.length does not match expectedLength.' + ' Ensure that the bytes are a Buffer.');\n    }\n\n    return this.encodeChecked(Buffer.from((0, utils_1.concatArgs)(versions, bytes)));\n  }\n\n  _encodeRaw(bytes) {\n    return this._codec.encode(bytes);\n  }\n  /* eslint-enable max-lines-per-function */\n\n\n  _decodeRaw(base58string) {\n    return this._codec.decode(base58string);\n  }\n\n  _verifyCheckSum(bytes) {\n    const computed = this._sha256(this._sha256(bytes.slice(0, -4))).slice(0, 4);\n\n    const checksum = bytes.slice(-4);\n    return (0, utils_1.seqEqual)(computed, checksum);\n  }\n\n}\n/**\n * XRP codec\n */\n// base58 encodings: https://xrpl.org/base58-encodings.html\n// Account address (20 bytes)\n\n\nconst ACCOUNT_ID = 0; // Account public key (33 bytes)\n\nconst ACCOUNT_PUBLIC_KEY = 0x23; // 33; Seed value (for secret keys) (16 bytes)\n\nconst FAMILY_SEED = 0x21; // 28; Validation public key (33 bytes)\n\nconst NODE_PUBLIC = 0x1c; // [1, 225, 75]\n\nconst ED25519_SEED = [0x01, 0xe1, 0x4b];\nconst codecOptions = {\n  sha256(bytes) {\n    return createHash('sha256').update(Buffer.from(bytes)).digest();\n  },\n\n  alphabet: 'rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz'\n};\nconst codecWithXrpAlphabet = new Codec(codecOptions);\nexports.codec = codecWithXrpAlphabet; // entropy is a Buffer of size 16\n// type is 'ed25519' or 'secp256k1'\n\nfunction encodeSeed(entropy, type) {\n  if (entropy.length !== 16) {\n    throw new Error('entropy must have length 16');\n  }\n\n  const opts = {\n    expectedLength: 16,\n    // for secp256k1, use `FAMILY_SEED`\n    versions: type === 'ed25519' ? ED25519_SEED : [FAMILY_SEED]\n  }; // prefixes entropy with version bytes\n\n  return codecWithXrpAlphabet.encode(entropy, opts);\n}\n\nexports.encodeSeed = encodeSeed;\n\nfunction decodeSeed(seed) {\n  let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    versionTypes: ['ed25519', 'secp256k1'],\n    versions: [ED25519_SEED, FAMILY_SEED],\n    expectedLength: 16\n  };\n  return codecWithXrpAlphabet.decode(seed, opts);\n}\n\nexports.decodeSeed = decodeSeed;\n\nfunction encodeAccountID(bytes) {\n  const opts = {\n    versions: [ACCOUNT_ID],\n    expectedLength: 20\n  };\n  return codecWithXrpAlphabet.encode(bytes, opts);\n}\n\nexports.encodeAccountID = encodeAccountID;\n/* eslint-disable import/no-unused-modules ---\n * unclear why this is aliased but we should keep it in case someone else is\n * importing it with the aliased name */\n\nexports.encodeAddress = encodeAccountID;\n/* eslint-enable import/no-unused-modules */\n\nfunction decodeAccountID(accountId) {\n  const opts = {\n    versions: [ACCOUNT_ID],\n    expectedLength: 20\n  };\n  return codecWithXrpAlphabet.decode(accountId, opts).bytes;\n}\n\nexports.decodeAccountID = decodeAccountID;\n/* eslint-disable import/no-unused-modules ---\n * unclear why this is aliased but we should keep it in case someone else is\n * importing it with the aliased name */\n\nexports.decodeAddress = decodeAccountID;\n/* eslint-enable import/no-unused-modules */\n\nfunction decodeNodePublic(base58string) {\n  const opts = {\n    versions: [NODE_PUBLIC],\n    expectedLength: 33\n  };\n  return codecWithXrpAlphabet.decode(base58string, opts).bytes;\n}\n\nexports.decodeNodePublic = decodeNodePublic;\n\nfunction encodeNodePublic(bytes) {\n  const opts = {\n    versions: [NODE_PUBLIC],\n    expectedLength: 33\n  };\n  return codecWithXrpAlphabet.encode(bytes, opts);\n}\n\nexports.encodeNodePublic = encodeNodePublic;\n\nfunction encodeAccountPublic(bytes) {\n  const opts = {\n    versions: [ACCOUNT_PUBLIC_KEY],\n    expectedLength: 33\n  };\n  return codecWithXrpAlphabet.encode(bytes, opts);\n}\n\nexports.encodeAccountPublic = encodeAccountPublic;\n\nfunction decodeAccountPublic(base58string) {\n  const opts = {\n    versions: [ACCOUNT_PUBLIC_KEY],\n    expectedLength: 33\n  };\n  return codecWithXrpAlphabet.decode(base58string, opts).bytes;\n}\n\nexports.decodeAccountPublic = decodeAccountPublic;\n\nfunction isValidClassicAddress(address) {\n  try {\n    decodeAccountID(address);\n  } catch (_error) {\n    return false;\n  }\n\n  return true;\n}\n\nexports.isValidClassicAddress = isValidClassicAddress;","map":{"version":3,"mappings":"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","names":["Codec","constructor","options","_sha256","sha256","_alphabet","alphabet","_codec","baseCodec","encode","bytes","opts","versions","_encodeVersioned","expectedLength","decode","base58string","types","versionTypes","withoutSum","decodeChecked","length","Error","versionLengthGuess","payloadLength","_a","versionBytes","slice","payload","i","version","Array","isArray","type","encodeChecked","buffer","check","_encodeRaw","Buffer","from","_decodeRaw","_verifyCheckSum","computed","checksum","ACCOUNT_ID","ACCOUNT_PUBLIC_KEY","FAMILY_SEED","NODE_PUBLIC","ED25519_SEED","codecOptions","createHash","update","digest","codecWithXrpAlphabet","exports","encodeSeed","entropy","decodeSeed","seed","encodeAccountID","decodeAccountID","accountId","decodeNodePublic","encodeNodePublic","encodeAccountPublic","decodeAccountPublic","isValidClassicAddress","address","_error"],"sourceRoot":"","sources":["../src/xrp-codec.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}