{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst _ = __importStar(require(\"lodash\"));\n\nconst assert = __importStar(require(\"assert\"));\n\nconst common_1 = require(\"../../common\");\n\nconst AccountFlags = common_1.constants.AccountFlags;\n\nconst fields_1 = __importDefault(require(\"./fields\"));\n\nfunction getAccountRootModifiedNode(tx) {\n  const modifiedNodes = tx.meta.AffectedNodes.filter(node => node.ModifiedNode.LedgerEntryType === 'AccountRoot');\n  assert.ok(modifiedNodes.length === 1);\n  return modifiedNodes[0].ModifiedNode;\n}\n\nfunction parseFlags(tx) {\n  const settings = {};\n\n  if (tx.TransactionType !== 'AccountSet') {\n    return settings;\n  }\n\n  const node = getAccountRootModifiedNode(tx);\n\n  const oldFlags = _.get(node.PreviousFields, 'Flags');\n\n  const newFlags = _.get(node.FinalFields, 'Flags');\n\n  if (oldFlags != null && newFlags != null) {\n    const changedFlags = oldFlags ^ newFlags;\n    const setFlags = newFlags & changedFlags;\n    const clearedFlags = oldFlags & changedFlags;\n    Object.entries(AccountFlags).forEach(entry => {\n      const [flagName, flagValue] = entry;\n\n      if (setFlags & flagValue) {\n        settings[flagName] = true;\n      } else if (clearedFlags & flagValue) {\n        settings[flagName] = false;\n      }\n    });\n  }\n\n  const oldField = _.get(node.PreviousFields, 'AccountTxnID');\n\n  const newField = _.get(node.FinalFields, 'AccountTxnID');\n\n  if (newField && !oldField) {\n    settings.enableTransactionIDTracking = true;\n  } else if (oldField && !newField) {\n    settings.enableTransactionIDTracking = false;\n  }\n\n  return settings;\n}\n\nfunction parseSettings(tx) {\n  const txType = tx.TransactionType;\n  assert.ok(txType === 'AccountSet' || txType === 'SetRegularKey' || txType === 'SignerListSet');\n  return Object.assign({}, parseFlags(tx), fields_1.default(tx));\n}\n\nexports.default = parseSettings;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA,MAAMA,YAAY,GAAGC,mBAAUD,YAA/B;;AACA;;AAEA,SAASE,0BAAT,CAAoCC,EAApC,EAA2C;AACzC,QAAMC,aAAa,GAAGD,EAAE,CAACE,IAAH,CAAQC,aAAR,CAAsBC,MAAtB,CACnBC,IAAD,IAAUA,IAAI,CAACC,YAAL,CAAkBC,eAAlB,KAAsC,aAD5B,CAAtB;AAGAC,QAAM,CAACC,EAAP,CAAUR,aAAa,CAACS,MAAd,KAAyB,CAAnC;AACA,SAAOT,aAAa,CAAC,CAAD,CAAb,CAAiBK,YAAxB;AACD;;AAED,SAASK,UAAT,CAAoBX,EAApB,EAA2B;AACzB,QAAMY,QAAQ,GAAQ,EAAtB;;AACA,MAAIZ,EAAE,CAACa,eAAH,KAAuB,YAA3B,EAAyC;AACvC,WAAOD,QAAP;AACD;;AAED,QAAMP,IAAI,GAAGN,0BAA0B,CAACC,EAAD,CAAvC;;AACA,QAAMc,QAAQ,GAAGC,CAAC,CAACC,GAAF,CAAMX,IAAI,CAACY,cAAX,EAA2B,OAA3B,CAAjB;;AACA,QAAMC,QAAQ,GAAGH,CAAC,CAACC,GAAF,CAAMX,IAAI,CAACc,WAAX,EAAwB,OAAxB,CAAjB;;AAEA,MAAIL,QAAQ,IAAI,IAAZ,IAAoBI,QAAQ,IAAI,IAApC,EAA0C;AACxC,UAAME,YAAY,GAAGN,QAAQ,GAAGI,QAAhC;AACA,UAAMG,QAAQ,GAAGH,QAAQ,GAAGE,YAA5B;AACA,UAAME,YAAY,GAAGR,QAAQ,GAAGM,YAAhC;AACAG,UAAM,CAACC,OAAP,CAAe3B,YAAf,EAA6B4B,OAA7B,CAAqCC,KAAK,IAAG;AAC3C,YAAM,CAACC,QAAD,EAAWC,SAAX,IAAwBF,KAA9B;;AACA,UAAIL,QAAQ,GAAGO,SAAf,EAA0B;AACxBhB,gBAAQ,CAACe,QAAD,CAAR,GAAqB,IAArB;AACD,OAFD,MAEO,IAAIL,YAAY,GAAGM,SAAnB,EAA8B;AACnChB,gBAAQ,CAACe,QAAD,CAAR,GAAqB,KAArB;AACD;AACF,KAPD;AAQD;;AAMD,QAAME,QAAQ,GAAGd,CAAC,CAACC,GAAF,CAAMX,IAAI,CAACY,cAAX,EAA2B,cAA3B,CAAjB;;AACA,QAAMa,QAAQ,GAAGf,CAAC,CAACC,GAAF,CAAMX,IAAI,CAACc,WAAX,EAAwB,cAAxB,CAAjB;;AACA,MAAIW,QAAQ,IAAI,CAACD,QAAjB,EAA2B;AACzBjB,YAAQ,CAACmB,2BAAT,GAAuC,IAAvC;AACD,GAFD,MAEO,IAAIF,QAAQ,IAAI,CAACC,QAAjB,EAA2B;AAChClB,YAAQ,CAACmB,2BAAT,GAAuC,KAAvC;AACD;;AAED,SAAOnB,QAAP;AACD;;AAED,SAASoB,aAAT,CAAuBhC,EAAvB,EAA8B;AAC5B,QAAMiC,MAAM,GAAGjC,EAAE,CAACa,eAAlB;AACAL,QAAM,CAACC,EAAP,CACEwB,MAAM,KAAK,YAAX,IACEA,MAAM,KAAK,eADb,IAEEA,MAAM,KAAK,eAHf;AAMA,SAAOV,MAAM,CAACW,MAAP,CAAc,EAAd,EAAkBvB,UAAU,CAACX,EAAD,CAA5B,EAAkCmC,iBAAYnC,EAAZ,CAAlC,CAAP;AACD;;AAEDoC,kBAAeJ,aAAf","names":["AccountFlags","common_1","getAccountRootModifiedNode","tx","modifiedNodes","meta","AffectedNodes","filter","node","ModifiedNode","LedgerEntryType","assert","ok","length","parseFlags","settings","TransactionType","oldFlags","_","get","PreviousFields","newFlags","FinalFields","changedFlags","setFlags","clearedFlags","Object","entries","forEach","entry","flagName","flagValue","oldField","newField","enableTransactionIDTracking","parseSettings","txType","assign","fields_1","exports"],"sourceRoot":"","sources":["../../../../src/ledger/parse/settings.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}