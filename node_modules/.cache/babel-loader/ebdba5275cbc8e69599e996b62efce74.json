{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ContractWrapper = void 0;\n\nconst path_1 = __importDefault(require(\"path\"));\n\nconst fs_1 = __importDefault(require(\"fs\"));\n\nconst __1 = require(\"..\");\n\nconst chainSendContext_1 = require(\"./chainSendContext\");\n\nconst generateMethods_1 = require(\"./generateMethods\");\n\nconst formattedCall_1 = require(\"./formattedCall\");\n\nconst argumentErrorContext_1 = require(\"../argumentErrorContext\");\n\nconst __2 = require(\"../..\");\n\nconst preparedCall_1 = require(\"./preparedCall\");\n\nconst _1 = require(\".\");\n\nconst testutils_1 = require(\"../../testutils\");\n/**\n * Provides a simple interface in order to easily call or query the smart contract's methods.\n */\n\n\nclass ContractWrapper extends chainSendContext_1.ChainSendContext {\n  constructor(smartContract, abi, wasmPath, context, builtinFunctions) {\n    super(context);\n    this.context = context;\n    this.smartContract = smartContract;\n    this.abi = abi;\n    this.wasmPath = wasmPath;\n    this.builtinFunctions = builtinFunctions || this;\n    this.call = generateMethods_1.generateMethods(this, this.abi, this.handleCall);\n    this.results = generateMethods_1.generateMethods(this, this.abi, this.handleResults);\n    this.query = generateMethods_1.generateMethods(this, this.abi, this.handleQuery);\n    this.format = generateMethods_1.generateMethods(this, this.abi, this.handleFormat);\n    let constructor = this.abi.getConstructorDefinition();\n\n    if (constructor !== null) {\n      this.call.deploy = this.handleDeployCall.bind(this, constructor);\n      this.format.deploy = this.handleFormat.bind(this, constructor);\n    }\n  }\n\n  address(address) {\n    let typedAddress = __1.NativeSerializer.convertNativeToAddress(address, new argumentErrorContext_1.ArgumentErrorContext(\"address\", \"0\", new __1.EndpointParameterDefinition(\"address\", \"\", new __1.AddressType())));\n\n    this.smartContract.setAddress(typedAddress);\n    return this;\n  }\n\n  getAddress() {\n    return this.smartContract.getAddress();\n  }\n\n  getAbi() {\n    return this.abi;\n  }\n\n  getSmartContract() {\n    return this.smartContract;\n  }\n\n  getCode() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.wasmPath == null) {\n        throw new __2.Err(\"contract wasm path not configured\");\n      }\n\n      return yield testutils_1.loadContractCode(this.wasmPath);\n    });\n  }\n\n  buildDeployTransaction(constructorDefinition, args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let contractCode = yield this.getCode();\n      let convertedArgs = formattedCall_1.formatEndpoint(constructorDefinition, constructorDefinition, ...args).toTypedValues();\n      let transaction = this.smartContract.deploy({\n        code: contractCode,\n        gasLimit: this.context.getGasLimit(),\n        initArguments: convertedArgs\n      });\n      return transaction;\n    });\n  }\n\n  handleDeployCall(constructorDefinition) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    return __awaiter(this, void 0, void 0, function* () {\n      let transaction = yield this.buildDeployTransaction(constructorDefinition, args);\n      let transactionOnNetwork = yield this.processTransaction(transaction);\n      let smartContractResults = transactionOnNetwork.getSmartContractResults();\n      let immediateResult = smartContractResults.getImmediate();\n      immediateResult.assertSuccess();\n      let logger = this.context.getLogger();\n      logger === null || logger === void 0 ? void 0 : logger.deployComplete(transaction, smartContractResults, this.smartContract.getAddress());\n    });\n  }\n\n  static loadProject(provider, builtinFunctions, projectPath, filenameHint, sendContext) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let {\n        abiPath,\n        wasmPath\n      } = yield expandProjectPath(projectPath, filenameHint);\n      let abi = yield __1.SmartContractAbi.fromAbiPath(abiPath);\n      let smartContract = new __1.SmartContract({\n        abi: abi\n      });\n      sendContext = sendContext || new _1.SendContext(provider).logger(new _1.ContractLogger());\n      return new ContractWrapper(smartContract, abi, wasmPath, sendContext, builtinFunctions);\n    });\n  }\n\n  handleQuery(endpoint) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    return __awaiter(this, void 0, void 0, function* () {\n      let preparedCall = yield this.prepareCallWithPayment(endpoint, args);\n      let interaction = this.convertPreparedCallToInteraction(preparedCall);\n      let provider = this.context.getProvider();\n      let logger = this.context.getLogger();\n      let query = interaction.buildQuery();\n      logger === null || logger === void 0 ? void 0 : logger.queryCreated(query);\n      let optionalSender = this.context.getSenderOptional();\n\n      if (optionalSender != null) {\n        query.caller = optionalSender.address;\n      }\n\n      let response = yield provider.queryContract(query);\n      let queryResponseBundle = interaction.interpretQueryResponse(response);\n      let result = queryResponseBundle.queryResponse.unpackOutput();\n      logger === null || logger === void 0 ? void 0 : logger.queryComplete(result, response);\n      return result;\n    });\n  }\n\n  handleCall(endpoint) {\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n\n    return __awaiter(this, void 0, void 0, function* () {\n      let {\n        transaction,\n        interaction\n      } = this.buildTransactionAndInteraction(endpoint, args);\n      let {\n        result\n      } = yield this.processTransactionAndInterpretResults({\n        transaction,\n        interaction\n      });\n      return result;\n    });\n  }\n\n  handleResults(endpoint) {\n    for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      args[_key4 - 1] = arguments[_key4];\n    }\n\n    return __awaiter(this, void 0, void 0, function* () {\n      let {\n        transaction,\n        interaction\n      } = this.buildTransactionAndInteraction(endpoint, args);\n      let {\n        executionResultsBundle\n      } = yield this.processTransactionAndInterpretResults({\n        transaction,\n        interaction\n      });\n      return executionResultsBundle;\n    });\n  }\n\n  processTransactionAndInterpretResults(_ref) {\n    let {\n      transaction,\n      interaction\n    } = _ref;\n    return __awaiter(this, void 0, void 0, function* () {\n      let transactionOnNetwork = yield this.processTransaction(transaction);\n      let executionResultsBundle = interaction.interpretExecutionResults(transactionOnNetwork);\n      let {\n        smartContractResults,\n        immediateResult\n      } = executionResultsBundle;\n      let result = immediateResult === null || immediateResult === void 0 ? void 0 : immediateResult.unpackOutput();\n      let logger = this.context.getLogger();\n      logger === null || logger === void 0 ? void 0 : logger.transactionComplete(result, immediateResult === null || immediateResult === void 0 ? void 0 : immediateResult.data, transaction, smartContractResults);\n      return {\n        executionResultsBundle,\n        result\n      };\n    });\n  }\n\n  processTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let provider = this.context.getProvider();\n      let sender = this.context.getSender();\n      transaction.setNonce(sender.account.nonce);\n      yield sender.signer.sign(transaction);\n      let logger = this.context.getLogger();\n      logger === null || logger === void 0 ? void 0 : logger.transactionCreated(transaction);\n      yield transaction.send(provider); // increment the nonce only after the transaction is sent\n      // since an exception thrown by the provider means we will have to re-use the same nonce\n      // otherwise the next transactions will hang (and never complete)\n\n      sender.account.incrementNonce();\n      logger === null || logger === void 0 ? void 0 : logger.transactionSent(transaction);\n      yield transaction.awaitExecuted(provider);\n      let transactionOnNetwork = yield transaction.getAsOnNetwork(provider, true, false, true);\n\n      if (transaction.getStatus().isFailed()) {\n        // TODO: extract the error messages\n        //let results = transactionOnNetwork.getSmartContractResults().getAllResults();\n        //let messages = results.map((result) => console.log(result));\n        throw new __2.ErrContract(`Transaction status failed: [${transaction.getStatus().toString()}].`); // Return messages:\\n${messages}`);\n      }\n\n      return transactionOnNetwork;\n    });\n  }\n\n  handleFormat(endpoint) {\n    for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      args[_key5 - 1] = arguments[_key5];\n    }\n\n    let {\n      formattedCall\n    } = this.prepareCallWithPayment(endpoint, args);\n    return formattedCall;\n  }\n\n  buildTransactionAndInteraction(endpoint, args) {\n    let preparedCall = this.prepareCallWithPayment(endpoint, args);\n    let interaction = this.convertPreparedCallToInteraction(preparedCall);\n    interaction.withGasLimit(this.context.getGasLimit());\n    let transaction = interaction.buildTransaction();\n    return {\n      transaction,\n      interaction\n    };\n  }\n\n  prepareCallWithPayment(endpoint, args) {\n    let value = this.context.getAndResetValue();\n\n    if (value == null && endpoint.modifiers.isPayable()) {\n      throw new __2.Err(\"Did not provide any value for a payable method\");\n    }\n\n    if (value != null && !endpoint.modifiers.isPayable()) {\n      throw new __2.Err(\"A value was provided for a non-payable method\");\n    }\n\n    if (value != null && !endpoint.modifiers.isPayableInToken(value.token.getTokenIdentifier())) {\n      throw new __2.Err(`Token ${value.token.getTokenIdentifier()} is not accepted by payable method. Accepted tokens: ${endpoint.modifiers.payableInTokens}`);\n    }\n\n    let formattedCall = formattedCall_1.formatEndpoint(endpoint, endpoint, ...args);\n    let preparedCall = new preparedCall_1.PreparedCall(this.smartContract.getAddress(), __2.Egld(0), formattedCall);\n    this.applyValueModfiers(value, preparedCall);\n    return preparedCall;\n  }\n\n  convertPreparedCallToInteraction(preparedCall) {\n    let executingFunction = preparedCall.formattedCall.getExecutingFunction();\n    let interpretingFunction = preparedCall.formattedCall.getInterpretingFunction();\n    let typedValueArgs = preparedCall.formattedCall.toTypedValues();\n    let interaction = new __1.Interaction(this.smartContract, executingFunction, interpretingFunction, typedValueArgs, preparedCall.receiver);\n    interaction.withValue(preparedCall.egldValue);\n    return interaction;\n  }\n\n  applyValueModfiers(value, preparedCall) {\n    if (value == null) {\n      return;\n    }\n\n    if (value.token.isEgld()) {\n      preparedCall.egldValue = value;\n      return;\n    }\n\n    if (value.token.isFungible()) {\n      preparedCall.wrap(this.builtinFunctions.format.ESDTTransfer(value.token.getTokenIdentifier(), value.valueOf(), preparedCall.formattedCall));\n    } else {\n      preparedCall.receiver = this.context.getSender().address;\n      preparedCall.wrap(this.builtinFunctions.format.ESDTNFTTransfer(value.token.getTokenIdentifier(), value.getNonce(), value.valueOf(), this.smartContract, preparedCall.formattedCall));\n    }\n  }\n\n}\n\nexports.ContractWrapper = ContractWrapper;\n\nfunction filterByExtension(fileList, extension) {\n  return fileList.filter(name => name.endsWith(extension));\n}\n\nfunction filterByFilename(fileList, filename) {\n  return fileList.filter(name => name == filename);\n} // Compiling creates a temporary file which sometimes doesn't get deleted. It should be ignored.\n\n\nfunction ignoreTemporaryWasmFiles(fileList) {\n  let temporaryWasmFiles = filterByExtension(fileList, \"_wasm.wasm\");\n  let difference = fileList.filter(file => temporaryWasmFiles.indexOf(file) === -1);\n  return difference;\n}\n\nfunction filterWithHint(fileList, extension, filenameHint) {\n  if (filenameHint) {\n    let pattern = filenameHint + extension;\n    return {\n      pattern,\n      filteredFileList: filterByFilename(fileList, pattern)\n    };\n  }\n\n  return {\n    pattern: \"*\" + extension,\n    filteredFileList: filterByExtension(fileList, extension)\n  };\n}\n\nfunction getFileByExtension(fileList, folderPath, extension, filenameHint) {\n  let {\n    pattern,\n    filteredFileList\n  } = filterWithHint(fileList, extension, filenameHint);\n\n  if (filteredFileList.length != 1) {\n    throw new __2.ErrInvalidArgument(`Expected a single ${pattern} file in ${folderPath} (found ${filteredFileList.length})`);\n  }\n\n  return path_1.default.join(folderPath, filteredFileList[0]);\n}\n\nfunction getAbiAndWasmPaths(outputPath, filenameHint) {\n  return __awaiter(this, void 0, void 0, function* () {\n    let filesInOutput = yield fs_1.default.promises.readdir(outputPath);\n    filesInOutput = ignoreTemporaryWasmFiles(filesInOutput);\n    let abiPath = getFileByExtension(filesInOutput, outputPath, \".abi.json\", filenameHint);\n    let wasmPath;\n\n    try {\n      wasmPath = getFileByExtension(filesInOutput, outputPath, \".wasm\", filenameHint);\n    } catch (_) {\n      wasmPath = null;\n    }\n\n    return {\n      abiPath,\n      wasmPath\n    };\n  });\n}\n\nfunction expandProjectPath(projectPath, filenameHint) {\n  return __awaiter(this, void 0, void 0, function* () {\n    projectPath = path_1.default.resolve(projectPath);\n\n    try {\n      return yield getAbiAndWasmPaths(projectPath, filenameHint);\n    } catch (_) {\n      let outputPath = path_1.default.join(projectPath, \"output\");\n      return yield getAbiAndWasmPaths(outputPath, filenameHint);\n    }\n  });\n}","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;AAEA;;;;;AAGA,MAAaA,eAAb,SAAqCC,mCAArC,CAAqD;AAWjDC,cACIC,aADJ,EAEIC,GAFJ,EAGIC,QAHJ,EAIIC,OAJJ,EAKIC,gBALJ,EAK4C;AAExC,UAAMD,OAAN;AACA,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKH,aAAL,GAAqBA,aAArB;AACA,SAAKC,GAAL,GAAWA,GAAX;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKE,gBAAL,GAAwBA,gBAAgB,IAAI,IAA5C;AAGA,SAAKC,IAAL,GAAYC,kCAAgB,IAAhB,EAAsB,KAAKL,GAA3B,EAAgC,KAAKM,UAArC,CAAZ;AAEA,SAAKC,OAAL,GAAeF,kCAAgB,IAAhB,EAAsB,KAAKL,GAA3B,EAAgC,KAAKQ,aAArC,CAAf;AAEA,SAAKC,KAAL,GAAaJ,kCAAgB,IAAhB,EAAsB,KAAKL,GAA3B,EAAgC,KAAKU,WAArC,CAAb;AAEA,SAAKC,MAAL,GAAcN,kCAAgB,IAAhB,EAAsB,KAAKL,GAA3B,EAAgC,KAAKY,YAArC,CAAd;AAEA,QAAId,WAAW,GAAG,KAAKE,GAAL,CAASa,wBAAT,EAAlB;;AACA,QAAIf,WAAW,KAAK,IAApB,EAA0B;AACtB,WAAKM,IAAL,CAAUU,MAAV,GAAmB,KAAKC,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,EAAiClB,WAAjC,CAAnB;AACA,WAAKa,MAAL,CAAYG,MAAZ,GAAqB,KAAKF,YAAL,CAAkBI,IAAlB,CAAuB,IAAvB,EAA6BlB,WAA7B,CAArB;AACH;AACJ;;AAEDmB,SAAO,CAACA,OAAD,EAAmC;AACtC,QAAIC,YAAY,GAAGC,qBAAiBC,sBAAjB,CAAwCH,OAAxC,EAAiD,IAAII,2CAAJ,CAAyB,SAAzB,EAAoC,GAApC,EAAyC,IAAIF,+BAAJ,CAAgC,SAAhC,EAA2C,EAA3C,EAA+C,IAAIA,eAAJ,EAA/C,CAAzC,CAAjD,CAAnB;;AACA,SAAKpB,aAAL,CAAmBuB,UAAnB,CAA8BJ,YAA9B;AACA,WAAO,IAAP;AACH;;AAEDK,YAAU;AACN,WAAO,KAAKxB,aAAL,CAAmBwB,UAAnB,EAAP;AACH;;AAEDC,QAAM;AACF,WAAO,KAAKxB,GAAZ;AACH;;AAEDyB,kBAAgB;AACZ,WAAO,KAAK1B,aAAZ;AACH;;AAEK2B,SAAO;;AACT,UAAI,KAAKzB,QAAL,IAAiB,IAArB,EAA2B;AACvB,cAAM,IAAI0B,OAAJ,CAAQ,mCAAR,CAAN;AACH;;AACD,aAAO,MAAMC,6BAAiB,KAAK3B,QAAtB,CAAb;AACH;AAAA;;AAEa4B,wBAAsB,CAACC,qBAAD,EAA4CC,IAA5C,EAAuD;;AACvF,UAAIC,YAAY,GAAG,MAAM,KAAKN,OAAL,EAAzB;AAEA,UAAIO,aAAa,GAAGC,+BAAeJ,qBAAf,EAAsCA,qBAAtC,EAA6D,GAAGC,IAAhE,EAAsEI,aAAtE,EAApB;AACA,UAAIC,WAAW,GAAG,KAAKrC,aAAL,CAAmBe,MAAnB,CAA0B;AACxCuB,YAAI,EAAEL,YADkC;AAExCM,gBAAQ,EAAE,KAAKpC,OAAL,CAAaqC,WAAb,EAF8B;AAGxCC,qBAAa,EAAEP;AAHyB,OAA1B,CAAlB;AAKA,aAAOG,WAAP;AACH;AAAA;;AAEarB,kBAAgB,CAACe,qBAAD,EAA0D;AAAA,sCAAXC,IAAW;AAAXA,UAAW;AAAA;;;AACpF,UAAIK,WAAW,GAAG,MAAM,KAAKP,sBAAL,CAA4BC,qBAA5B,EAAmDC,IAAnD,CAAxB;AAEA,UAAIU,oBAAoB,GAAG,MAAM,KAAKC,kBAAL,CAAwBN,WAAxB,CAAjC;AAEA,UAAIO,oBAAoB,GAAGF,oBAAoB,CAACG,uBAArB,EAA3B;AACA,UAAIC,eAAe,GAAGF,oBAAoB,CAACG,YAArB,EAAtB;AACAD,qBAAe,CAACE,aAAhB;AACA,UAAIC,MAAM,GAAG,KAAK9C,OAAL,CAAa+C,SAAb,EAAb;AACAD,YAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEE,cAAR,CAAuBd,WAAvB,EAAoCO,oBAApC,EAA0D,KAAK5C,aAAL,CAAmBwB,UAAnB,EAA1D;AACH;AAAA;;AAEuB,SAAX4B,WAAW,CAACC,QAAD,EAAsBjD,gBAAtB,EAAgEkD,WAAhE,EAAqFC,YAArF,EAA4GC,WAA5G,EAAqI;;AACzJ,UAAI;AAAEC,eAAF;AAAWvD;AAAX,UAAwB,MAAMwD,iBAAiB,CAACJ,WAAD,EAAcC,YAAd,CAAnD;AACA,UAAItD,GAAG,GAAG,MAAMmB,qBAAiBuC,WAAjB,CAA6BF,OAA7B,CAAhB;AACA,UAAIzD,aAAa,GAAG,IAAIoB,iBAAJ,CAAkB;AAAEnB,WAAG,EAAEA;AAAP,OAAlB,CAApB;AAEAuD,iBAAW,GAAGA,WAAW,IAAI,IAAII,cAAJ,CAAgBP,QAAhB,EAA0BJ,MAA1B,CAAiC,IAAIW,iBAAJ,EAAjC,CAA7B;AACA,aAAO,IAAI/D,eAAJ,CAAoBG,aAApB,EAAmCC,GAAnC,EAAwCC,QAAxC,EAAkDsD,WAAlD,EAA+DpD,gBAA/D,CAAP;AACH;AAAA;;AAEKO,aAAW,CAACkD,QAAD,EAA6C;AAAA,uCAAX7B,IAAW;AAAXA,UAAW;AAAA;;;AAC1D,UAAI8B,YAAY,GAAG,MAAM,KAAKC,sBAAL,CAA4BF,QAA5B,EAAsC7B,IAAtC,CAAzB;AACA,UAAIgC,WAAW,GAAG,KAAKC,gCAAL,CAAsCH,YAAtC,CAAlB;AACA,UAAIT,QAAQ,GAAG,KAAKlD,OAAL,CAAa+D,WAAb,EAAf;AACA,UAAIjB,MAAM,GAAG,KAAK9C,OAAL,CAAa+C,SAAb,EAAb;AAEA,UAAIxC,KAAK,GAAGsD,WAAW,CAACG,UAAZ,EAAZ;AACAlB,YAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEmB,YAAR,CAAqB1D,KAArB;AACA,UAAI2D,cAAc,GAAG,KAAKlE,OAAL,CAAamE,iBAAb,EAArB;;AACA,UAAID,cAAc,IAAI,IAAtB,EAA4B;AACxB3D,aAAK,CAAC6D,MAAN,GAAeF,cAAc,CAACnD,OAA9B;AACH;;AACD,UAAIsD,QAAQ,GAAG,MAAMnB,QAAQ,CAACoB,aAAT,CAAuB/D,KAAvB,CAArB;AACA,UAAIgE,mBAAmB,GAAGV,WAAW,CAACW,sBAAZ,CAAmCH,QAAnC,CAA1B;AACA,UAAII,MAAM,GAAGF,mBAAmB,CAACG,aAApB,CAAkCC,YAAlC,EAAb;AACA7B,YAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAE8B,aAAR,CAAsBH,MAAtB,EAA8BJ,QAA9B;AAEA,aAAOI,MAAP;AACH;AAAA;;AAEKrE,YAAU,CAACsD,QAAD,EAA6C;AAAA,uCAAX7B,IAAW;AAAXA,UAAW;AAAA;;;AACzD,UAAI;AAAEK,mBAAF;AAAe2B;AAAf,UAA+B,KAAKgB,8BAAL,CAAoCnB,QAApC,EAA8C7B,IAA9C,CAAnC;AACA,UAAI;AAAE4C;AAAF,UAAa,MAAM,KAAKK,qCAAL,CAA2C;AAAE5C,mBAAF;AAAe2B;AAAf,OAA3C,CAAvB;AACA,aAAOY,MAAP;AACH;AAAA;;AAEKnE,eAAa,CAACoD,QAAD,EAA6C;AAAA,uCAAX7B,IAAW;AAAXA,UAAW;AAAA;;;AAC5D,UAAI;AAAEK,mBAAF;AAAe2B;AAAf,UAA+B,KAAKgB,8BAAL,CAAoCnB,QAApC,EAA8C7B,IAA9C,CAAnC;AACA,UAAI;AAAEkD;AAAF,UAA6B,MAAM,KAAKD,qCAAL,CAA2C;AAAE5C,mBAAF;AAAe2B;AAAf,OAA3C,CAAvC;AACA,aAAOkB,sBAAP;AACH;AAAA;;AAEKD,uCAAqC,OAG1C;AAAA,QAH2C;AAAE5C,iBAAF;AAAe2B;AAAf,KAG3C;;AACG,UAAItB,oBAAoB,GAAG,MAAM,KAAKC,kBAAL,CAAwBN,WAAxB,CAAjC;AACA,UAAI6C,sBAAsB,GAAGlB,WAAW,CAACmB,yBAAZ,CAAsCzC,oBAAtC,CAA7B;AACA,UAAI;AAAEE,4BAAF;AAAwBE;AAAxB,UAA4CoC,sBAAhD;AACA,UAAIN,MAAM,GAAG9B,eAAe,SAAf,mBAAe,WAAf,GAAe,MAAf,kBAAe,CAAEgC,YAAjB,EAAb;AACA,UAAI7B,MAAM,GAAG,KAAK9C,OAAL,CAAa+C,SAAb,EAAb;AACAD,YAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAEmC,mBAAR,CAA4BR,MAA5B,EAAoC9B,eAAe,SAAf,mBAAe,WAAf,GAAe,MAAf,kBAAe,CAAEuC,IAArD,EAA2DhD,WAA3D,EAAwEO,oBAAxE;AACA,aAAO;AAAEsC,8BAAF;AAA0BN;AAA1B,OAAP;AACH;AAAA;;AAEKjC,oBAAkB,CAACN,WAAD,EAAyB;;AAC7C,UAAIgB,QAAQ,GAAG,KAAKlD,OAAL,CAAa+D,WAAb,EAAf;AACA,UAAIoB,MAAM,GAAG,KAAKnF,OAAL,CAAaoF,SAAb,EAAb;AACAlD,iBAAW,CAACmD,QAAZ,CAAqBF,MAAM,CAACG,OAAP,CAAeC,KAApC;AACA,YAAMJ,MAAM,CAACK,MAAP,CAAcC,IAAd,CAAmBvD,WAAnB,CAAN;AAEA,UAAIY,MAAM,GAAG,KAAK9C,OAAL,CAAa+C,SAAb,EAAb;AACAD,YAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAE4C,kBAAR,CAA2BxD,WAA3B;AACA,YAAMA,WAAW,CAACyD,IAAZ,CAAiBzC,QAAjB,CAAN,EAEA;AACA;AACA;;AACAiC,YAAM,CAACG,OAAP,CAAeM,cAAf;AAEA9C,YAAM,SAAN,UAAM,WAAN,GAAM,MAAN,SAAM,CAAE+C,eAAR,CAAwB3D,WAAxB;AACA,YAAMA,WAAW,CAAC4D,aAAZ,CAA0B5C,QAA1B,CAAN;AACA,UAAIX,oBAAoB,GAAG,MAAML,WAAW,CAAC6D,cAAZ,CAA2B7C,QAA3B,EAAqC,IAArC,EAA2C,KAA3C,EAAkD,IAAlD,CAAjC;;AACA,UAAIhB,WAAW,CAAC8D,SAAZ,GAAwBC,QAAxB,EAAJ,EAAwC;AACpC;AACA;AACA;AACA,cAAM,IAAIxE,eAAJ,CAAgB,+BAA+BS,WAAW,CAAC8D,SAAZ,GAAwBE,QAAxB,EAAkC,IAAjF,CAAN,CAJoC,CAIyD;AAChG;;AACD,aAAO3D,oBAAP;AACH;AAAA;;AAED7B,cAAY,CAACgD,QAAD,EAA6C;AAAA,uCAAX7B,IAAW;AAAXA,UAAW;AAAA;;AACrD,QAAI;AAAEsE;AAAF,QAAoB,KAAKvC,sBAAL,CAA4BF,QAA5B,EAAsC7B,IAAtC,CAAxB;AACA,WAAOsE,aAAP;AACH;;AAEDtB,gCAA8B,CAACnB,QAAD,EAA+B7B,IAA/B,EAA0C;AACpE,QAAI8B,YAAY,GAAG,KAAKC,sBAAL,CAA4BF,QAA5B,EAAsC7B,IAAtC,CAAnB;AACA,QAAIgC,WAAW,GAAG,KAAKC,gCAAL,CAAsCH,YAAtC,CAAlB;AACAE,eAAW,CAACuC,YAAZ,CAAyB,KAAKpG,OAAL,CAAaqC,WAAb,EAAzB;AACA,QAAIH,WAAW,GAAG2B,WAAW,CAACwC,gBAAZ,EAAlB;AACA,WAAO;AAAEnE,iBAAF;AAAe2B;AAAf,KAAP;AACH;;AAEDD,wBAAsB,CAACF,QAAD,EAA+B7B,IAA/B,EAA0C;AAC5D,QAAIyE,KAAK,GAAG,KAAKtG,OAAL,CAAauG,gBAAb,EAAZ;;AACA,QAAID,KAAK,IAAI,IAAT,IAAiB5C,QAAQ,CAAC8C,SAAT,CAAmBC,SAAnB,EAArB,EAAqD;AACjD,YAAM,IAAIhF,OAAJ,CAAQ,gDAAR,CAAN;AACH;;AACD,QAAI6E,KAAK,IAAI,IAAT,IAAiB,CAAC5C,QAAQ,CAAC8C,SAAT,CAAmBC,SAAnB,EAAtB,EAAsD;AAClD,YAAM,IAAIhF,OAAJ,CAAQ,+CAAR,CAAN;AACH;;AACD,QAAI6E,KAAK,IAAI,IAAT,IAAiB,CAAC5C,QAAQ,CAAC8C,SAAT,CAAmBE,gBAAnB,CAAoCJ,KAAK,CAACK,KAAN,CAAYC,kBAAZ,EAApC,CAAtB,EAA6F;AACzF,YAAM,IAAInF,OAAJ,CAAQ,SAAS6E,KAAK,CAACK,KAAN,CAAYC,kBAAZ,EAAgC,wDAAwDlD,QAAQ,CAAC8C,SAAT,CAAmBK,eAAe,EAA3I,CAAN;AACH;;AACD,QAAIV,aAAa,GAAGnE,+BAAe0B,QAAf,EAAyBA,QAAzB,EAAmC,GAAG7B,IAAtC,CAApB;AACA,QAAI8B,YAAY,GAAG,IAAImD,2BAAJ,CAAiB,KAAKjH,aAAL,CAAmBwB,UAAnB,EAAjB,EAAkDI,SAAK,CAAL,CAAlD,EAA2D0E,aAA3D,CAAnB;AACA,SAAKY,kBAAL,CAAwBT,KAAxB,EAA+B3C,YAA/B;AACA,WAAOA,YAAP;AACH;;AAEDG,kCAAgC,CAACH,YAAD,EAA2B;AACvD,QAAIqD,iBAAiB,GAAGrD,YAAY,CAACwC,aAAb,CAA2Bc,oBAA3B,EAAxB;AACA,QAAIC,oBAAoB,GAAGvD,YAAY,CAACwC,aAAb,CAA2BgB,uBAA3B,EAA3B;AACA,QAAIC,cAAc,GAAGzD,YAAY,CAACwC,aAAb,CAA2BlE,aAA3B,EAArB;AACA,QAAI4B,WAAW,GAAG,IAAI5C,eAAJ,CAAgB,KAAKpB,aAArB,EAAoCmH,iBAApC,EAAuDE,oBAAvD,EAA6EE,cAA7E,EAA6FzD,YAAY,CAAC0D,QAA1G,CAAlB;AACAxD,eAAW,CAACyD,SAAZ,CAAsB3D,YAAY,CAAC4D,SAAnC;AACA,WAAO1D,WAAP;AACH;;AAEDkD,oBAAkB,CAACT,KAAD,EAAwB3C,YAAxB,EAAkD;AAChE,QAAI2C,KAAK,IAAI,IAAb,EAAmB;AACf;AACH;;AACD,QAAIA,KAAK,CAACK,KAAN,CAAYa,MAAZ,EAAJ,EAA0B;AACtB7D,kBAAY,CAAC4D,SAAb,GAAyBjB,KAAzB;AACA;AACH;;AACD,QAAIA,KAAK,CAACK,KAAN,CAAYc,UAAZ,EAAJ,EAA8B;AAC1B9D,kBAAY,CAAC+D,IAAb,CACI,KAAKzH,gBAAL,CAAsBQ,MAAtB,CAA6BkH,YAA7B,CACIrB,KAAK,CAACK,KAAN,CAAYC,kBAAZ,EADJ,EAEIN,KAAK,CAACsB,OAAN,EAFJ,EAGIjE,YAAY,CAACwC,aAHjB,CADJ;AAOH,KARD,MAQO;AACHxC,kBAAY,CAAC0D,QAAb,GAAwB,KAAKrH,OAAL,CAAaoF,SAAb,GAAyBrE,OAAjD;AACA4C,kBAAY,CAAC+D,IAAb,CACI,KAAKzH,gBAAL,CAAsBQ,MAAtB,CAA6BoH,eAA7B,CACIvB,KAAK,CAACK,KAAN,CAAYC,kBAAZ,EADJ,EAEIN,KAAK,CAACwB,QAAN,EAFJ,EAGIxB,KAAK,CAACsB,OAAN,EAHJ,EAII,KAAK/H,aAJT,EAKI8D,YAAY,CAACwC,aALjB,CADJ;AASH;AACJ;;AA9OgD;;AAArD4B;;AAkPA,SAASC,iBAAT,CAA2BC,QAA3B,EAA+CC,SAA/C,EAAgE;AAC5D,SAAOD,QAAQ,CAACE,MAAT,CAAgBC,IAAI,IAAIA,IAAI,CAACC,QAAL,CAAcH,SAAd,CAAxB,CAAP;AACH;;AAED,SAASI,gBAAT,CAA0BL,QAA1B,EAA8CM,QAA9C,EAA8D;AAC1D,SAAON,QAAQ,CAACE,MAAT,CAAgBC,IAAI,IAAIA,IAAI,IAAIG,QAAhC,CAAP;AACH,C,CAED;;;AACA,SAASC,wBAAT,CAAkCP,QAAlC,EAAoD;AAChD,MAAIQ,kBAAkB,GAAGT,iBAAiB,CAACC,QAAD,EAAW,YAAX,CAA1C;AACA,MAAIS,UAAU,GAAGT,QAAQ,CAACE,MAAT,CAAgBQ,IAAI,IAAIF,kBAAkB,CAACG,OAAnB,CAA2BD,IAA3B,MAAqC,CAAC,CAA9D,CAAjB;AACA,SAAOD,UAAP;AACH;;AAED,SAASG,cAAT,CAAwBZ,QAAxB,EAA4CC,SAA5C,EAA+D9E,YAA/D,EAAoF;AAChF,MAAIA,YAAJ,EAAkB;AACd,QAAI0F,OAAO,GAAG1F,YAAY,GAAG8E,SAA7B;AACA,WAAO;AACHY,aADG;AAEHC,sBAAgB,EAAET,gBAAgB,CAACL,QAAD,EAAWa,OAAX;AAF/B,KAAP;AAIH;;AACD,SAAO;AACHA,WAAO,EAAE,MAAMZ,SADZ;AAEHa,oBAAgB,EAAEf,iBAAiB,CAACC,QAAD,EAAWC,SAAX;AAFhC,GAAP;AAIH;;AAED,SAASc,kBAAT,CAA4Bf,QAA5B,EAAgDgB,UAAhD,EAAoEf,SAApE,EAAuF9E,YAAvF,EAA4G;AACxG,MAAI;AAAE0F,WAAF;AAAWC;AAAX,MAAgCF,cAAc,CAACZ,QAAD,EAAWC,SAAX,EAAsB9E,YAAtB,CAAlD;;AACA,MAAI2F,gBAAgB,CAACG,MAAjB,IAA2B,CAA/B,EAAkC;AAC9B,UAAM,IAAIzH,sBAAJ,CAAuB,qBAAqBqH,OAAO,YAAYG,UAAU,WAAWF,gBAAgB,CAACG,MAAM,GAA3G,CAAN;AACH;;AACD,SAAOC,eAAKC,IAAL,CAAUH,UAAV,EAAsBF,gBAAgB,CAAC,CAAD,CAAtC,CAAP;AACH;;AAED,SAAeM,kBAAf,CAAkCC,UAAlC,EAAsDlG,YAAtD,EAA2E;;AACvE,QAAImG,aAAa,GAAG,MAAMC,aAAGC,QAAH,CAAYC,OAAZ,CAAoBJ,UAApB,CAA1B;AACAC,iBAAa,GAAGf,wBAAwB,CAACe,aAAD,CAAxC;AAEA,QAAIjG,OAAO,GAAG0F,kBAAkB,CAACO,aAAD,EAAgBD,UAAhB,EAA4B,WAA5B,EAAyClG,YAAzC,CAAhC;AACA,QAAIrD,QAAJ;;AACA,QAAI;AACAA,cAAQ,GAAGiJ,kBAAkB,CAACO,aAAD,EAAgBD,UAAhB,EAA4B,OAA5B,EAAqClG,YAArC,CAA7B;AACH,KAFD,CAEE,OAAOuG,CAAP,EAAU;AACR5J,cAAQ,GAAG,IAAX;AACH;;AACD,WAAO;AAAEuD,aAAF;AAAWvD;AAAX,KAAP;AACH;AAAA;;AAED,SAAewD,iBAAf,CAAiCJ,WAAjC,EAAsDC,YAAtD,EAA2E;;AACvED,eAAW,GAAGgG,eAAKS,OAAL,CAAazG,WAAb,CAAd;;AACA,QAAI;AACA,aAAO,MAAMkG,kBAAkB,CAAClG,WAAD,EAAcC,YAAd,CAA/B;AACH,KAFD,CAGA,OAAOuG,CAAP,EAAU;AACN,UAAIL,UAAU,GAAGH,eAAKC,IAAL,CAAUjG,WAAV,EAAuB,QAAvB,CAAjB;AACA,aAAO,MAAMkG,kBAAkB,CAACC,UAAD,EAAalG,YAAb,CAA/B;AACH;AACJ;AAAA","names":["ContractWrapper","chainSendContext_1","constructor","smartContract","abi","wasmPath","context","builtinFunctions","call","generateMethods_1","handleCall","results","handleResults","query","handleQuery","format","handleFormat","getConstructorDefinition","deploy","handleDeployCall","bind","address","typedAddress","__1","convertNativeToAddress","argumentErrorContext_1","setAddress","getAddress","getAbi","getSmartContract","getCode","__2","testutils_1","buildDeployTransaction","constructorDefinition","args","contractCode","convertedArgs","formattedCall_1","toTypedValues","transaction","code","gasLimit","getGasLimit","initArguments","transactionOnNetwork","processTransaction","smartContractResults","getSmartContractResults","immediateResult","getImmediate","assertSuccess","logger","getLogger","deployComplete","loadProject","provider","projectPath","filenameHint","sendContext","abiPath","expandProjectPath","fromAbiPath","_1","endpoint","preparedCall","prepareCallWithPayment","interaction","convertPreparedCallToInteraction","getProvider","buildQuery","queryCreated","optionalSender","getSenderOptional","caller","response","queryContract","queryResponseBundle","interpretQueryResponse","result","queryResponse","unpackOutput","queryComplete","buildTransactionAndInteraction","processTransactionAndInterpretResults","executionResultsBundle","interpretExecutionResults","transactionComplete","data","sender","getSender","setNonce","account","nonce","signer","sign","transactionCreated","send","incrementNonce","transactionSent","awaitExecuted","getAsOnNetwork","getStatus","isFailed","toString","formattedCall","withGasLimit","buildTransaction","value","getAndResetValue","modifiers","isPayable","isPayableInToken","token","getTokenIdentifier","payableInTokens","preparedCall_1","applyValueModfiers","executingFunction","getExecutingFunction","interpretingFunction","getInterpretingFunction","typedValueArgs","receiver","withValue","egldValue","isEgld","isFungible","wrap","ESDTTransfer","valueOf","ESDTNFTTransfer","getNonce","exports","filterByExtension","fileList","extension","filter","name","endsWith","filterByFilename","filename","ignoreTemporaryWasmFiles","temporaryWasmFiles","difference","file","indexOf","filterWithHint","pattern","filteredFileList","getFileByExtension","folderPath","length","path_1","join","getAbiAndWasmPaths","outputPath","filesInOutput","fs_1","promises","readdir","_","resolve"],"sourceRoot":"","sources":["../../../src/smartcontracts/wrapper/contractWrapper.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}