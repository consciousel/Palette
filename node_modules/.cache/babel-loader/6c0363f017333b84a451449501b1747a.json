{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Amount = void 0;\n\nvar decimal_js_1 = require(\"decimal.js\");\n\nvar binary_parser_1 = require(\"../serdes/binary-parser\");\n\nvar account_id_1 = require(\"./account-id\");\n\nvar currency_1 = require(\"./currency\");\n\nvar serialized_type_1 = require(\"./serialized-type\");\n\nvar bigInt = require(\"big-integer\");\n\nvar buffer_1 = require(\"buffer/\");\n/**\n * Constants for validating amounts\n */\n\n\nvar MIN_IOU_EXPONENT = -96;\nvar MAX_IOU_EXPONENT = 80;\nvar MAX_IOU_PRECISION = 16;\nvar MAX_DROPS = new decimal_js_1.Decimal('1e17');\nvar MIN_XRP = new decimal_js_1.Decimal('1e-6');\nvar mask = bigInt(0x00000000ffffffff);\n/**\n * decimal.js configuration for Amount IOUs\n */\n\ndecimal_js_1.Decimal.config({\n  toExpPos: MAX_IOU_EXPONENT + MAX_IOU_PRECISION,\n  toExpNeg: MIN_IOU_EXPONENT - MAX_IOU_PRECISION\n});\n/**\n * Type guard for AmountObject\n */\n\nfunction isAmountObject(arg) {\n  var keys = Object.keys(arg).sort();\n  return keys.length === 3 && keys[0] === 'currency' && keys[1] === 'issuer' && keys[2] === 'value';\n}\n/**\n * Class for serializing/Deserializing Amounts\n */\n\n\nvar Amount =\n/** @class */\nfunction (_super) {\n  __extends(Amount, _super);\n\n  function Amount(bytes) {\n    return _super.call(this, bytes !== null && bytes !== void 0 ? bytes : Amount.defaultAmount.bytes) || this;\n  }\n  /**\n   * Construct an amount from an IOU or string amount\n   *\n   * @param value An Amount, object representing an IOU, or a string\n   *     representing an integer amount\n   * @returns An Amount object\n   */\n\n\n  Amount.from = function (value) {\n    if (value instanceof Amount) {\n      return value;\n    }\n\n    var amount = buffer_1.Buffer.alloc(8);\n\n    if (typeof value === 'string') {\n      Amount.assertXrpIsValid(value);\n      var number = bigInt(value);\n      var intBuf = [buffer_1.Buffer.alloc(4), buffer_1.Buffer.alloc(4)];\n      intBuf[0].writeUInt32BE(Number(number.shiftRight(32)), 0);\n      intBuf[1].writeUInt32BE(Number(number.and(mask)), 0);\n      amount = buffer_1.Buffer.concat(intBuf);\n      amount[0] |= 0x40;\n      return new Amount(amount);\n    }\n\n    if (isAmountObject(value)) {\n      var number = new decimal_js_1.Decimal(value.value);\n      Amount.assertIouIsValid(number);\n\n      if (number.isZero()) {\n        amount[0] |= 0x80;\n      } else {\n        var integerNumberString = number.times(\"1e\".concat(-(number.e - 15))).abs().toString();\n        var num = bigInt(integerNumberString);\n        var intBuf = [buffer_1.Buffer.alloc(4), buffer_1.Buffer.alloc(4)];\n        intBuf[0].writeUInt32BE(Number(num.shiftRight(32)), 0);\n        intBuf[1].writeUInt32BE(Number(num.and(mask)), 0);\n        amount = buffer_1.Buffer.concat(intBuf);\n        amount[0] |= 0x80;\n\n        if (number.gt(new decimal_js_1.Decimal(0))) {\n          amount[0] |= 0x40;\n        }\n\n        var exponent = number.e - 15;\n        var exponentByte = 97 + exponent;\n        amount[0] |= exponentByte >>> 2;\n        amount[1] |= (exponentByte & 0x03) << 6;\n      }\n\n      var currency = currency_1.Currency.from(value.currency).toBytes();\n      var issuer = account_id_1.AccountID.from(value.issuer).toBytes();\n      return new Amount(buffer_1.Buffer.concat([amount, currency, issuer]));\n    }\n\n    throw new Error('Invalid type to construct an Amount');\n  };\n  /**\n   * Read an amount from a BinaryParser\n   *\n   * @param parser BinaryParser to read the Amount from\n   * @returns An Amount object\n   */\n\n\n  Amount.fromParser = function (parser) {\n    var isXRP = parser.peek() & 0x80;\n    var numBytes = isXRP ? 48 : 8;\n    return new Amount(parser.read(numBytes));\n  };\n  /**\n   * Get the JSON representation of this Amount\n   *\n   * @returns the JSON interpretation of this.bytes\n   */\n\n\n  Amount.prototype.toJSON = function () {\n    if (this.isNative()) {\n      var bytes = this.bytes;\n      var isPositive = bytes[0] & 0x40;\n      var sign = isPositive ? '' : '-';\n      bytes[0] &= 0x3f;\n      var msb = bigInt(bytes.slice(0, 4).readUInt32BE(0));\n      var lsb = bigInt(bytes.slice(4).readUInt32BE(0));\n      var num = msb.shiftLeft(32).or(lsb);\n      return \"\".concat(sign).concat(num.toString());\n    } else {\n      var parser = new binary_parser_1.BinaryParser(this.toString());\n      var mantissa = parser.read(8);\n      var currency = currency_1.Currency.fromParser(parser);\n      var issuer = account_id_1.AccountID.fromParser(parser);\n      var b1 = mantissa[0];\n      var b2 = mantissa[1];\n      var isPositive = b1 & 0x40;\n      var sign = isPositive ? '' : '-';\n      var exponent = ((b1 & 0x3f) << 2) + ((b2 & 0xff) >> 6) - 97;\n      mantissa[0] = 0;\n      mantissa[1] &= 0x3f;\n      var value = new decimal_js_1.Decimal(\"\".concat(sign, \"0x\").concat(mantissa.toString('hex'))).times(\"1e\".concat(exponent));\n      Amount.assertIouIsValid(value);\n      return {\n        value: value.toString(),\n        currency: currency.toJSON(),\n        issuer: issuer.toJSON()\n      };\n    }\n  };\n  /**\n   * Validate XRP amount\n   *\n   * @param amount String representing XRP amount\n   * @returns void, but will throw if invalid amount\n   */\n\n\n  Amount.assertXrpIsValid = function (amount) {\n    if (amount.indexOf('.') !== -1) {\n      throw new Error(\"\".concat(amount.toString(), \" is an illegal amount\"));\n    }\n\n    var decimal = new decimal_js_1.Decimal(amount);\n\n    if (!decimal.isZero()) {\n      if (decimal.lt(MIN_XRP) || decimal.gt(MAX_DROPS)) {\n        throw new Error(\"\".concat(amount.toString(), \" is an illegal amount\"));\n      }\n    }\n  };\n  /**\n   * Validate IOU.value amount\n   *\n   * @param decimal Decimal.js object representing IOU.value\n   * @returns void, but will throw if invalid amount\n   */\n\n\n  Amount.assertIouIsValid = function (decimal) {\n    if (!decimal.isZero()) {\n      var p = decimal.precision();\n      var e = decimal.e - 15;\n\n      if (p > MAX_IOU_PRECISION || e > MAX_IOU_EXPONENT || e < MIN_IOU_EXPONENT) {\n        throw new Error('Decimal precision out of range');\n      }\n\n      this.verifyNoDecimal(decimal);\n    }\n  };\n  /**\n   * Ensure that the value after being multiplied by the exponent does not\n   * contain a decimal.\n   *\n   * @param decimal a Decimal object\n   * @returns a string of the object without a decimal\n   */\n\n\n  Amount.verifyNoDecimal = function (decimal) {\n    var integerNumberString = decimal.times(\"1e\".concat(-(decimal.e - 15))).abs().toString();\n\n    if (integerNumberString.indexOf('.') !== -1) {\n      throw new Error('Decimal place found in integerNumberString');\n    }\n  };\n  /**\n   * Test if this amount is in units of Native Currency(XRP)\n   *\n   * @returns true if Native (XRP)\n   */\n\n\n  Amount.prototype.isNative = function () {\n    return (this.bytes[0] & 0x80) === 0;\n  };\n\n  Amount.defaultAmount = new Amount(buffer_1.Buffer.from('4000000000000000', 'hex'));\n  return Amount;\n}(serialized_type_1.SerializedType);\n\nexports.Amount = Amount;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AACA;;AACA;;AACA;AAEA;;;;;AAGA,IAAMA,gBAAgB,GAAG,CAAC,EAA1B;AACA,IAAMC,gBAAgB,GAAG,EAAzB;AACA,IAAMC,iBAAiB,GAAG,EAA1B;AACA,IAAMC,SAAS,GAAG,IAAIC,oBAAJ,CAAY,MAAZ,CAAlB;AACA,IAAMC,OAAO,GAAG,IAAID,oBAAJ,CAAY,MAAZ,CAAhB;AACA,IAAME,IAAI,GAAGC,MAAM,CAAC,kBAAD,CAAnB;AAEA;;;;AAGAH,qBAAQI,MAAR,CAAe;AACbC,UAAQ,EAAER,gBAAgB,GAAGC,iBADhB;AAEbQ,UAAQ,EAAEV,gBAAgB,GAAGE;AAFhB,CAAf;AAcA;;;;AAGA,SAASS,cAAT,CAAwBC,GAAxB,EAA2B;AACzB,MAAMC,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYD,GAAZ,EAAiBG,IAAjB,EAAb;AACA,SACEF,IAAI,CAACG,MAAL,KAAgB,CAAhB,IACAH,IAAI,CAAC,CAAD,CAAJ,KAAY,UADZ,IAEAA,IAAI,CAAC,CAAD,CAAJ,KAAY,QAFZ,IAGAA,IAAI,CAAC,CAAD,CAAJ,KAAY,OAJd;AAMD;AAED;;;;;AAGA;AAAA;AAAA;AAAqBI;;AAKnB,kBAAYC,KAAZ,EAAyB;WACvBC,kBAAMD,KAAK,SAAL,SAAK,WAAL,WAASE,MAAM,CAACC,aAAP,CAAqBH,KAApC,KAA0C;AAC3C;AAED;;;;;;;;;AAOOE,gBAAP,UAAsDE,KAAtD,EAA8D;AAC5D,QAAIA,KAAK,YAAYF,MAArB,EAA6B;AAC3B,aAAOE,KAAP;AACD;;AAED,QAAIC,MAAM,GAAGC,gBAAOC,KAAP,CAAa,CAAb,CAAb;;AACA,QAAI,OAAOH,KAAP,KAAiB,QAArB,EAA+B;AAC7BF,YAAM,CAACM,gBAAP,CAAwBJ,KAAxB;AAEA,UAAMK,MAAM,GAAGpB,MAAM,CAACe,KAAD,CAArB;AAEA,UAAMM,MAAM,GAAG,CAACJ,gBAAOC,KAAP,CAAa,CAAb,CAAD,EAAkBD,gBAAOC,KAAP,CAAa,CAAb,CAAlB,CAAf;AACAG,YAAM,CAAC,CAAD,CAAN,CAAUC,aAAV,CAAwBC,MAAM,CAACH,MAAM,CAACI,UAAP,CAAkB,EAAlB,CAAD,CAA9B,EAAuD,CAAvD;AACAH,YAAM,CAAC,CAAD,CAAN,CAAUC,aAAV,CAAwBC,MAAM,CAACH,MAAM,CAACK,GAAP,CAAW1B,IAAX,CAAD,CAA9B,EAAkD,CAAlD;AAEAiB,YAAM,GAAGC,gBAAOS,MAAP,CAAcL,MAAd,CAAT;AAEAL,YAAM,CAAC,CAAD,CAAN,IAAa,IAAb;AAEA,aAAO,IAAIH,MAAJ,CAAWG,MAAX,CAAP;AACD;;AAED,QAAIZ,cAAc,CAACW,KAAD,CAAlB,EAA2B;AACzB,UAAMK,MAAM,GAAG,IAAIvB,oBAAJ,CAAYkB,KAAK,CAACA,KAAlB,CAAf;AACAF,YAAM,CAACc,gBAAP,CAAwBP,MAAxB;;AAEA,UAAIA,MAAM,CAACQ,MAAP,EAAJ,EAAqB;AACnBZ,cAAM,CAAC,CAAD,CAAN,IAAa,IAAb;AACD,OAFD,MAEO;AACL,YAAMa,mBAAmB,GAAGT,MAAM,CAC/BU,KADyB,CACnB,YAAK,EAAEV,MAAM,CAACW,CAAP,GAAW,EAAb,CAAL,CADmB,EAEzBC,GAFyB,GAGzBC,QAHyB,EAA5B;AAKA,YAAMC,GAAG,GAAGlC,MAAM,CAAC6B,mBAAD,CAAlB;AACA,YAAMR,MAAM,GAAG,CAACJ,gBAAOC,KAAP,CAAa,CAAb,CAAD,EAAkBD,gBAAOC,KAAP,CAAa,CAAb,CAAlB,CAAf;AACAG,cAAM,CAAC,CAAD,CAAN,CAAUC,aAAV,CAAwBC,MAAM,CAACW,GAAG,CAACV,UAAJ,CAAe,EAAf,CAAD,CAA9B,EAAoD,CAApD;AACAH,cAAM,CAAC,CAAD,CAAN,CAAUC,aAAV,CAAwBC,MAAM,CAACW,GAAG,CAACT,GAAJ,CAAQ1B,IAAR,CAAD,CAA9B,EAA+C,CAA/C;AAEAiB,cAAM,GAAGC,gBAAOS,MAAP,CAAcL,MAAd,CAAT;AAEAL,cAAM,CAAC,CAAD,CAAN,IAAa,IAAb;;AAEA,YAAII,MAAM,CAACe,EAAP,CAAU,IAAItC,oBAAJ,CAAY,CAAZ,CAAV,CAAJ,EAA+B;AAC7BmB,gBAAM,CAAC,CAAD,CAAN,IAAa,IAAb;AACD;;AAED,YAAMoB,QAAQ,GAAGhB,MAAM,CAACW,CAAP,GAAW,EAA5B;AACA,YAAMM,YAAY,GAAG,KAAKD,QAA1B;AACApB,cAAM,CAAC,CAAD,CAAN,IAAaqB,YAAY,KAAK,CAA9B;AACArB,cAAM,CAAC,CAAD,CAAN,IAAa,CAACqB,YAAY,GAAG,IAAhB,KAAyB,CAAtC;AACD;;AAED,UAAMC,QAAQ,GAAGC,oBAASC,IAAT,CAAczB,KAAK,CAACuB,QAApB,EAA8BG,OAA9B,EAAjB;AACA,UAAMC,MAAM,GAAGC,uBAAUH,IAAV,CAAezB,KAAK,CAAC2B,MAArB,EAA6BD,OAA7B,EAAf;AACA,aAAO,IAAI5B,MAAJ,CAAWI,gBAAOS,MAAP,CAAc,CAACV,MAAD,EAASsB,QAAT,EAAmBI,MAAnB,CAAd,CAAX,CAAP;AACD;;AAED,UAAM,IAAIE,KAAJ,CAAU,qCAAV,CAAN;AACD,GA3DM;AA6DP;;;;;;;;AAMO/B,sBAAP,UAAkBgC,MAAlB,EAAsC;AACpC,QAAMC,KAAK,GAAGD,MAAM,CAACE,IAAP,KAAgB,IAA9B;AACA,QAAMC,QAAQ,GAAGF,KAAK,GAAG,EAAH,GAAQ,CAA9B;AACA,WAAO,IAAIjC,MAAJ,CAAWgC,MAAM,CAACI,IAAP,CAAYD,QAAZ,CAAX,CAAP;AACD,GAJM;AAMP;;;;;;;AAKAnC;AACE,QAAI,KAAKqC,QAAL,EAAJ,EAAqB;AACnB,UAAMvC,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMwC,UAAU,GAAGxC,KAAK,CAAC,CAAD,CAAL,GAAW,IAA9B;AACA,UAAMyC,IAAI,GAAGD,UAAU,GAAG,EAAH,GAAQ,GAA/B;AACAxC,WAAK,CAAC,CAAD,CAAL,IAAY,IAAZ;AAEA,UAAM0C,GAAG,GAAGrD,MAAM,CAACW,KAAK,CAAC2C,KAAN,CAAY,CAAZ,EAAe,CAAf,EAAkBC,YAAlB,CAA+B,CAA/B,CAAD,CAAlB;AACA,UAAMC,GAAG,GAAGxD,MAAM,CAACW,KAAK,CAAC2C,KAAN,CAAY,CAAZ,EAAeC,YAAf,CAA4B,CAA5B,CAAD,CAAlB;AACA,UAAMrB,GAAG,GAAGmB,GAAG,CAACI,SAAJ,CAAc,EAAd,EAAkBC,EAAlB,CAAqBF,GAArB,CAAZ;AAEA,aAAO,UAAGJ,IAAH,EAAO1B,MAAP,CAAUQ,GAAG,CAACD,QAAJ,EAAV,CAAP;AACD,KAXD,MAWO;AACL,UAAMY,MAAM,GAAG,IAAIc,4BAAJ,CAAiB,KAAK1B,QAAL,EAAjB,CAAf;AACA,UAAM2B,QAAQ,GAAGf,MAAM,CAACI,IAAP,CAAY,CAAZ,CAAjB;AACA,UAAMX,QAAQ,GAAGC,oBAASsB,UAAT,CAAoBhB,MAApB,CAAjB;AACA,UAAMH,MAAM,GAAGC,uBAAUkB,UAAV,CAAqBhB,MAArB,CAAf;AAEA,UAAMiB,EAAE,GAAGF,QAAQ,CAAC,CAAD,CAAnB;AACA,UAAMG,EAAE,GAAGH,QAAQ,CAAC,CAAD,CAAnB;AAEA,UAAMT,UAAU,GAAGW,EAAE,GAAG,IAAxB;AACA,UAAMV,IAAI,GAAGD,UAAU,GAAG,EAAH,GAAQ,GAA/B;AACA,UAAMf,QAAQ,GAAG,CAAC,CAAC0B,EAAE,GAAG,IAAN,KAAe,CAAhB,KAAsB,CAACC,EAAE,GAAG,IAAN,KAAe,CAArC,IAA0C,EAA3D;AAEAH,cAAQ,CAAC,CAAD,CAAR,GAAc,CAAd;AACAA,cAAQ,CAAC,CAAD,CAAR,IAAe,IAAf;AACA,UAAM7C,KAAK,GAAG,IAAIlB,oBAAJ,CAAY,UAAGuD,IAAH,EAAO,IAAP,EAAO1B,MAAP,CAAYkC,QAAQ,CAAC3B,QAAT,CAAkB,KAAlB,CAAZ,CAAZ,EAAoDH,KAApD,CACZ,YAAKM,QAAL,CADY,CAAd;AAGAvB,YAAM,CAACc,gBAAP,CAAwBZ,KAAxB;AAEA,aAAO;AACLA,aAAK,EAAEA,KAAK,CAACkB,QAAN,EADF;AAELK,gBAAQ,EAAEA,QAAQ,CAAC0B,MAAT,EAFL;AAGLtB,cAAM,EAAEA,MAAM,CAACsB,MAAP;AAHH,OAAP;AAKD;AACF,GAtCD;AAwCA;;;;;;;;AAMenD,4BAAf,UAAgCG,MAAhC,EAA8C;AAC5C,QAAIA,MAAM,CAACiD,OAAP,CAAe,GAAf,MAAwB,CAAC,CAA7B,EAAgC;AAC9B,YAAM,IAAIrB,KAAJ,CAAU,UAAG5B,MAAM,CAACiB,QAAP,EAAH,EAAoB,uBAApB,CAAV,CAAN;AACD;;AAED,QAAMiC,OAAO,GAAG,IAAIrE,oBAAJ,CAAYmB,MAAZ,CAAhB;;AACA,QAAI,CAACkD,OAAO,CAACtC,MAAR,EAAL,EAAuB;AACrB,UAAIsC,OAAO,CAACC,EAAR,CAAWrE,OAAX,KAAuBoE,OAAO,CAAC/B,EAAR,CAAWvC,SAAX,CAA3B,EAAkD;AAChD,cAAM,IAAIgD,KAAJ,CAAU,UAAG5B,MAAM,CAACiB,QAAP,EAAH,EAAoB,uBAApB,CAAV,CAAN;AACD;AACF;AACF,GAXc;AAaf;;;;;;;;AAMepB,4BAAf,UAAgCqD,OAAhC,EAAgD;AAC9C,QAAI,CAACA,OAAO,CAACtC,MAAR,EAAL,EAAuB;AACrB,UAAMwC,CAAC,GAAGF,OAAO,CAACG,SAAR,EAAV;AACA,UAAMtC,CAAC,GAAGmC,OAAO,CAACnC,CAAR,GAAY,EAAtB;;AACA,UACEqC,CAAC,GAAGzE,iBAAJ,IACAoC,CAAC,GAAGrC,gBADJ,IAEAqC,CAAC,GAAGtC,gBAHN,EAIE;AACA,cAAM,IAAImD,KAAJ,CAAU,gCAAV,CAAN;AACD;;AACD,WAAK0B,eAAL,CAAqBJ,OAArB;AACD;AACF,GAbc;AAef;;;;;;;;;AAOerD,2BAAf,UAA+BqD,OAA/B,EAA+C;AAC7C,QAAMrC,mBAAmB,GAAGqC,OAAO,CAChCpC,KADyB,CACnB,YAAK,EAAEoC,OAAO,CAACnC,CAAR,GAAY,EAAd,CAAL,CADmB,EAEzBC,GAFyB,GAGzBC,QAHyB,EAA5B;;AAKA,QAAIJ,mBAAmB,CAACoC,OAApB,CAA4B,GAA5B,MAAqC,CAAC,CAA1C,EAA6C;AAC3C,YAAM,IAAIrB,KAAJ,CAAU,4CAAV,CAAN;AACD;AACF,GATc;AAWf;;;;;;;AAKQ/B,8BAAR;AACE,WAAO,CAAC,KAAKF,KAAL,CAAW,CAAX,IAAgB,IAAjB,MAA2B,CAAlC;AACD,GAFO;;AApMDE,yBAAwB,IAAIA,MAAJ,CAC7BI,gBAAOuB,IAAP,CAAY,kBAAZ,EAAgC,KAAhC,CAD6B,CAAxB;AAuMT;AAAC,CAxMD,CAAqB+B,gCAArB;;AA0MSC","names":["MIN_IOU_EXPONENT","MAX_IOU_EXPONENT","MAX_IOU_PRECISION","MAX_DROPS","decimal_js_1","MIN_XRP","mask","bigInt","config","toExpPos","toExpNeg","isAmountObject","arg","keys","Object","sort","length","__extends","bytes","_super","Amount","defaultAmount","value","amount","buffer_1","alloc","assertXrpIsValid","number","intBuf","writeUInt32BE","Number","shiftRight","and","concat","assertIouIsValid","isZero","integerNumberString","times","e","abs","toString","num","gt","exponent","exponentByte","currency","currency_1","from","toBytes","issuer","account_id_1","Error","parser","isXRP","peek","numBytes","read","isNative","isPositive","sign","msb","slice","readUInt32BE","lsb","shiftLeft","or","binary_parser_1","mantissa","fromParser","b1","b2","toJSON","indexOf","decimal","lt","p","precision","verifyNoDecimal","serialized_type_1","exports"],"sourceRoot":"","sources":["../../src/types/amount.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}