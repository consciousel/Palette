{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SignableMessage = exports.MESSAGE_PREFIX = void 0;\n\nconst signature_1 = require(\"./signature\");\n\nconst address_1 = require(\"./address\");\n\nconst createKeccakHash = require(\"keccak\");\n\nexports.MESSAGE_PREFIX = \"\\x17Elrond Signed Message:\\n\";\n\nclass SignableMessage {\n  constructor(init) {\n    this.message = Buffer.from([]);\n    this.signature = new signature_1.Signature();\n    this.version = 1;\n    this.signer = \"ErdJS\";\n    this.address = new address_1.Address();\n    Object.assign(this, init);\n  }\n\n  serializeForSigning() {\n    const messageSize = Buffer.from(this.message.length.toString());\n    const signableMessage = Buffer.concat([messageSize, this.message]);\n    let bytesToHash = Buffer.concat([Buffer.from(exports.MESSAGE_PREFIX), signableMessage]);\n    return createKeccakHash(\"keccak256\").update(bytesToHash).digest();\n  }\n\n  serializeForSigningRaw() {\n    return Buffer.concat([this.getMessageSize(), this.message]);\n  }\n\n  getSignature() {\n    return this.signature;\n  }\n\n  applySignature(signature) {\n    this.signature = signature;\n  }\n\n  getMessageSize() {\n    const messageSize = Buffer.alloc(4);\n    messageSize.writeUInt32BE(this.message.length, 0);\n    return messageSize;\n  }\n\n  toJSON() {\n    return {\n      address: this.address.bech32(),\n      message: \"0x\" + this.message.toString('hex'),\n      signature: \"0x\" + this.signature.hex(),\n      version: this.version,\n      signer: this.signer\n    };\n  }\n\n}\n\nexports.SignableMessage = SignableMessage;","map":{"version":3,"mappings":";;;;;;;AACA;;AACA;;AAEA,MAAMA,gBAAgB,GAAGC,OAAO,CAAC,QAAD,CAAhC;;AAEaC,yBAAiB,8BAAjB;;AAEb,MAAaC,eAAb,CAA4B;AA0B1BC,cAAmBC,IAAnB,EAAkD;AAChD,SAAKC,OAAL,GAAeC,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAf;AACA,SAAKC,SAAL,GAAiB,IAAIC,qBAAJ,EAAjB;AACA,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,MAAL,GAAc,OAAd;AACA,SAAKC,OAAL,GAAe,IAAIC,iBAAJ,EAAf;AAEAC,UAAM,CAACC,MAAP,CAAc,IAAd,EAAoBX,IAApB;AACD;;AAEDY,qBAAmB;AACjB,UAAMC,WAAW,GAAGX,MAAM,CAACC,IAAP,CAAY,KAAKF,OAAL,CAAaa,MAAb,CAAoBC,QAApB,EAAZ,CAApB;AACA,UAAMC,eAAe,GAAGd,MAAM,CAACe,MAAP,CAAc,CAACJ,WAAD,EAAc,KAAKZ,OAAnB,CAAd,CAAxB;AACA,QAAIiB,WAAW,GAAGhB,MAAM,CAACe,MAAP,CAAc,CAACf,MAAM,CAACC,IAAP,CAAYN,sBAAZ,CAAD,EAA8BmB,eAA9B,CAAd,CAAlB;AAEA,WAAOrB,gBAAgB,CAAC,WAAD,CAAhB,CAA8BwB,MAA9B,CAAqCD,WAArC,EAAkDE,MAAlD,EAAP;AACD;;AAEDC,wBAAsB;AACpB,WAAOnB,MAAM,CAACe,MAAP,CAAc,CAAC,KAAKK,cAAL,EAAD,EAAwB,KAAKrB,OAA7B,CAAd,CAAP;AACD;;AAEDsB,cAAY;AACV,WAAO,KAAKnB,SAAZ;AACD;;AAEDoB,gBAAc,CAACpB,SAAD,EAAqB;AACjC,SAAKA,SAAL,GAAiBA,SAAjB;AACD;;AAEDkB,gBAAc;AACZ,UAAMT,WAAW,GAAGX,MAAM,CAACuB,KAAP,CAAa,CAAb,CAApB;AACAZ,eAAW,CAACa,aAAZ,CAA0B,KAAKzB,OAAL,CAAaa,MAAvC,EAA+C,CAA/C;AAEA,WAAOD,WAAP;AACD;;AAEDc,QAAM;AACJ,WAAO;AACLnB,aAAO,EAAE,KAAKA,OAAL,CAAaoB,MAAb,EADJ;AAEL3B,aAAO,EAAE,OAAO,KAAKA,OAAL,CAAac,QAAb,CAAsB,KAAtB,CAFX;AAGLX,eAAS,EAAE,OAAO,KAAKA,SAAL,CAAeyB,GAAf,EAHb;AAILvB,aAAO,EAAE,KAAKA,OAJT;AAKLC,YAAM,EAAE,KAAKA;AALR,KAAP;AAOD;;AAvEyB;;AAA5BV","names":["createKeccakHash","require","exports","SignableMessage","constructor","init","message","Buffer","from","signature","signature_1","version","signer","address","address_1","Object","assign","serializeForSigning","messageSize","length","toString","signableMessage","concat","bytesToHash","update","digest","serializeForSigningRaw","getMessageSize","getSignature","applySignature","alloc","writeUInt32BE","toJSON","bech32","hex"],"sourceRoot":"","sources":["../src/signableMessage.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}