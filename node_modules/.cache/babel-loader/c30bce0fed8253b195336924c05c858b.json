{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.inputTransferFilterFormatter = exports.inputBlockFilterFormatter = exports.inputLogFilterFormatter = exports.extendFormatters = void 0;\n\nconst debug = require('debug')('thor:injector');\n\nconst utils = require(\"../utils\");\n\nconst extendFormatters = function (web3) {\n  const web3Utils = web3.utils;\n  const outputTransactionFormatter = web3.extend.formatters.outputTransactionFormatter;\n\n  web3.extend.formatters.outputTransactionFormatter = function (tx) {\n    if (tx && tx.isThorified) {\n      debug('outputTransactionFormatter');\n      tx.chainTag = web3Utils.numberToHex(tx.chainTag);\n\n      if (tx.clauses) {\n        for (const clause of tx.clauses) {\n          clause.value = web3.extend.formatters.outputBigNumberFormatter(clause.value);\n        }\n      }\n\n      return tx;\n    } else {\n      return outputTransactionFormatter(tx);\n    }\n  };\n\n  const outputTransactionReceiptFormatter = web3.extend.formatters.outputTransactionReceiptFormatter;\n\n  web3.extend.formatters.outputTransactionReceiptFormatter = function (receipt) {\n    if (receipt && receipt.isThorified) {\n      debug('outputTransactionReceiptFormatter');\n\n      if (receipt.hasOwnProperty('transactionIndex')) {\n        delete receipt.transactionIndex;\n      }\n\n      if (receipt.hasOwnProperty('cumulativeGasUsed')) {\n        delete receipt.cumulativeGasUsed;\n      }\n\n      receipt.gasUsed = web3Utils.hexToNumber(receipt.gasUsed);\n\n      for (const output of receipt.outputs) {\n        if (output.events) {\n          output.events = output.events.map(event => {\n            if (!event.isThorified) {\n              Object.defineProperty(event, 'isThorified', {\n                get: () => true\n              });\n            }\n\n            return web3.extend.formatters.outputLogFormatter(event);\n          });\n        }\n      }\n\n      return receipt;\n    } else {\n      return outputTransactionReceiptFormatter(receipt);\n    }\n  };\n\n  const outputLogFormatter = web3.extend.formatters.outputLogFormatter;\n\n  web3.extend.formatters.outputLogFormatter = function (log) {\n    if (log && log.isThorified) {\n      debug('outputLogFormatter');\n\n      if (log.hasOwnProperty('transactionIndex')) {\n        delete log.transactionIndex;\n      }\n\n      if (log.hasOwnProperty('logIndex')) {\n        delete log.logIndex;\n      }\n\n      if (log.hasOwnProperty('id')) {\n        delete log.id;\n      }\n\n      return log;\n    } else {\n      return outputLogFormatter(log);\n    }\n  };\n};\n\nexports.extendFormatters = extendFormatters;\n\nconst inputLogFilterFormatter = function (options) {\n  if (options) {\n    const logFilterOptions = {};\n\n    if (options.address) {\n      logFilterOptions.address = utils.validAddressOrError(options.address);\n    }\n\n    if (options.pos) {\n      logFilterOptions.pos = utils.validBytes32OrError(options.pos, 'Invalid position(block ID)');\n    }\n\n    if (options.t0) {\n      logFilterOptions.t0 = utils.validBytes32OrError(options.t0, 'Invalid t0');\n    }\n\n    if (options.t1) {\n      logFilterOptions.t1 = utils.validBytes32OrError(options.t1, 'Invalid t1');\n    }\n\n    if (options.t2) {\n      logFilterOptions.t2 = utils.validBytes32OrError(options.t2, 'Invalid t2');\n    }\n\n    if (options.t3) {\n      logFilterOptions.t3 = utils.validBytes32OrError(options.t3, 'Invalid t3');\n    }\n\n    if (options.t4) {\n      logFilterOptions.t4 = utils.validBytes32OrError(options.t4, 'Invalid t4');\n    }\n\n    return logFilterOptions;\n  }\n};\n\nexports.inputLogFilterFormatter = inputLogFilterFormatter;\n\nconst inputBlockFilterFormatter = function (blockID) {\n  if (blockID) {\n    blockID = utils.validBytes32OrError(blockID, 'Invalid position(block ID)');\n    return blockID;\n  }\n};\n\nexports.inputBlockFilterFormatter = inputBlockFilterFormatter;\n\nconst inputTransferFilterFormatter = function (options) {\n  if (options) {\n    const transferFilterOptions = {};\n\n    if (options.pos) {\n      transferFilterOptions.pos = utils.validBytes32OrError(options.pos, 'Invalid position(block ID)');\n    }\n\n    if (options.txOrigin) {\n      transferFilterOptions.txOrigin = utils.validAddressOrError(options.txOrigin);\n    }\n\n    if (options.sender) {\n      transferFilterOptions.sender = utils.validAddressOrError(options.sender);\n    }\n\n    if (options.recipient) {\n      transferFilterOptions.recipient = utils.validAddressOrError(options.recipient);\n    }\n\n    return transferFilterOptions;\n  }\n};\n\nexports.inputTransferFilterFormatter = inputTransferFilterFormatter;","map":{"version":3,"mappings":"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","names":["debug","require","extendFormatters","web3","web3Utils","utils","outputTransactionFormatter","extend","formatters","tx","isThorified","chainTag","numberToHex","clauses","clause","value","outputBigNumberFormatter","outputTransactionReceiptFormatter","receipt","hasOwnProperty","transactionIndex","cumulativeGasUsed","gasUsed","hexToNumber","output","outputs","events","map","event","Object","defineProperty","get","outputLogFormatter","log","logIndex","id","exports","inputLogFilterFormatter","options","logFilterOptions","address","validAddressOrError","pos","validBytes32OrError","t0","t1","t2","t3","t4","inputBlockFilterFormatter","blockID","inputTransferFilterFormatter","transferFilterOptions","txOrigin","sender","recipient"],"sourceRoot":"","sources":["../../src/extend/formatters.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}