{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getFee = exports.getServerInfo = void 0;\n\nconst utils_1 = require(\"./utils\");\n\nconst bignumber_js_1 = __importDefault(require(\"bignumber.js\"));\n\nfunction renameKeys(object, mapping) {\n  Object.entries(mapping).forEach(entry => {\n    const [from, to] = entry;\n    object[to] = object[from];\n    delete object[from];\n  });\n}\n\nfunction getServerInfo() {\n  return this.request('server_info').then(response => {\n    const info = utils_1.convertKeysFromSnakeCaseToCamelCase(response.info);\n    renameKeys(info, {\n      hostid: 'hostID'\n    });\n\n    if (info.validatedLedger) {\n      renameKeys(info.validatedLedger, {\n        baseFeeXrp: 'baseFeeXRP',\n        reserveBaseXrp: 'reserveBaseXRP',\n        reserveIncXrp: 'reserveIncrementXRP',\n        seq: 'ledgerVersion'\n      });\n      info.validatedLedger.baseFeeXRP = info.validatedLedger.baseFeeXRP.toString();\n      info.validatedLedger.reserveBaseXRP = info.validatedLedger.reserveBaseXRP.toString();\n      info.validatedLedger.reserveIncrementXRP = info.validatedLedger.reserveIncrementXRP.toString();\n    }\n\n    return info;\n  });\n}\n\nexports.getServerInfo = getServerInfo;\n\nfunction getFee(cushion) {\n  return __awaiter(this, void 0, void 0, function* () {\n    if (cushion == null) {\n      cushion = this._feeCushion;\n    }\n\n    if (cushion == null) {\n      cushion = 1.2;\n    }\n\n    const serverInfo = (yield this.request('server_info')).info;\n    const baseFeeXrp = new bignumber_js_1.default(serverInfo.validated_ledger.base_fee_xrp);\n\n    if (serverInfo.load_factor == null) {\n      serverInfo.load_factor = 1;\n    }\n\n    let fee = baseFeeXrp.times(serverInfo.load_factor).times(cushion);\n    fee = bignumber_js_1.default.min(fee, this._maxFeeXRP);\n    return new bignumber_js_1.default(fee.toFixed(6)).toString(10);\n  });\n}\n\nexports.getFee = getFee;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;AACA;;AAiCA,SAASA,UAAT,CAAoBC,MAApB,EAAiDC,OAAjD,EAA6E;AAC3EC,QAAM,CAACC,OAAP,CAAeF,OAAf,EAAwBG,OAAxB,CAAgCC,KAAK,IAAG;AACtC,UAAM,CAACC,IAAD,EAAOC,EAAP,IAAaF,KAAnB;AACAL,UAAM,CAACO,EAAD,CAAN,GAAaP,MAAM,CAACM,IAAD,CAAnB;AACA,WAAON,MAAM,CAACM,IAAD,CAAb;AACD,GAJD;AAKD;;AAED,SAASE,aAAT,GAAsB;AACpB,SAAO,KAAKC,OAAL,CAAa,aAAb,EAA4BC,IAA5B,CAAkCC,QAAD,IAAa;AACnD,UAAMC,IAAI,GAAGC,4CAAoCF,QAAQ,CAACC,IAA7C,CAAb;AACAb,cAAU,CAACa,IAAD,EAAO;AAACE,YAAM,EAAE;AAAT,KAAP,CAAV;;AACA,QAAIF,IAAI,CAACG,eAAT,EAA0B;AACxBhB,gBAAU,CAACa,IAAI,CAACG,eAAN,EAAuB;AAC/BC,kBAAU,EAAE,YADmB;AAE/BC,sBAAc,EAAE,gBAFe;AAG/BC,qBAAa,EAAE,qBAHgB;AAI/BC,WAAG,EAAE;AAJ0B,OAAvB,CAAV;AAMAP,UAAI,CAACG,eAAL,CAAqBK,UAArB,GAAkCR,IAAI,CAACG,eAAL,CAAqBK,UAArB,CAAgCC,QAAhC,EAAlC;AACAT,UAAI,CAACG,eAAL,CAAqBO,cAArB,GAAsCV,IAAI,CAACG,eAAL,CAAqBO,cAArB,CAAoCD,QAApC,EAAtC;AACAT,UAAI,CAACG,eAAL,CAAqBQ,mBAArB,GAA2CX,IAAI,CAACG,eAAL,CAAqBQ,mBAArB,CAAyCF,QAAzC,EAA3C;AACD;;AACD,WAAOT,IAAP;AACD,GAfM,CAAP;AAgBD;;AA0BOY;;AAtBR,SAAeC,MAAf,CAAuCC,OAAvC,EAAuD;;AACrD,QAAIA,OAAO,IAAI,IAAf,EAAqB;AACnBA,aAAO,GAAG,KAAKC,WAAf;AACD;;AACD,QAAID,OAAO,IAAI,IAAf,EAAqB;AACnBA,aAAO,GAAG,GAAV;AACD;;AAED,UAAME,UAAU,GAAG,CAAC,MAAM,KAAKnB,OAAL,CAAa,aAAb,CAAP,EAAoCG,IAAvD;AACA,UAAMI,UAAU,GAAG,IAAIa,sBAAJ,CAAcD,UAAU,CAACE,gBAAX,CAA4BC,YAA1C,CAAnB;;AACA,QAAIH,UAAU,CAACI,WAAX,IAA0B,IAA9B,EAAoC;AAElCJ,gBAAU,CAACI,WAAX,GAAyB,CAAzB;AACD;;AACD,QAAIC,GAAG,GAAGjB,UAAU,CAACkB,KAAX,CAAiBN,UAAU,CAACI,WAA5B,EAAyCE,KAAzC,CAA+CR,OAA/C,CAAV;AAGAO,OAAG,GAAGJ,uBAAUM,GAAV,CAAcF,GAAd,EAAmB,KAAKG,UAAxB,CAAN;AAEA,WAAO,IAAIP,sBAAJ,CAAcI,GAAG,CAACI,OAAJ,CAAY,CAAZ,CAAd,EAA8BhB,QAA9B,CAAuC,EAAvC,CAAP;AACD;AAAA;;AAEsBG","names":["renameKeys","object","mapping","Object","entries","forEach","entry","from","to","getServerInfo","request","then","response","info","utils_1","hostid","validatedLedger","baseFeeXrp","reserveBaseXrp","reserveIncXrp","seq","baseFeeXRP","toString","reserveBaseXRP","reserveIncrementXRP","exports","getFee","cushion","_feeCushion","serverInfo","bignumber_js_1","validated_ledger","base_fee_xrp","load_factor","fee","times","min","_maxFeeXRP","toFixed"],"sourceRoot":"","sources":["../../../src/common/serverinfo.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}